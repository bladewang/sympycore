"""Generated low-level arithmetic methods for CommutativeRingWithPairs.

This file is generated by the src/mk_pairs_ops.py script.
See http://sympycore.googlecode.com/ for more information.

DO NOT CHANGE THIS FILE DIRECTLY!!!
"""

from ..core import Expr
from ..utils import NUMBER, SYMBOL, TERMS, FACTORS
from ..arithmetic.numbers import (normalized_fraction,
  FractionTuple, try_power, numbertypes)
from ..arithmetic.infinity import Infinity

#new = Expr.__new__

def div(a, b, cls):
    tb = type(b)
    if tb is int or tb is long:
        ta = type(a)
        if ta is int or tb is long:
            if not b:
                if not a:
                    return cls.undefined
                return cls.zoo
            return normalized_fraction(a, b)
        if not b:
            return a * cls.zoo
        if b == 1:
            return a
        return a * FractionTuple((1,b))
    return a / b




def expand_mul_method(cls, self, other):
    lhead, ldata = self.pair
    rhead, rdata = other.pair
    if lhead is FACTORS:
        if rhead is FACTORS:
            #MUL_FACTORS_FACTORS(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
            pairs = dict(ldata)
            pairs_get = pairs.get
            number = 1
            for t,c in rdata.iteritems():
                #MUL_FACTOR_VALUE_DICT(FACTOR=t; SIGN=+; USIGN=; VALUE=c; DICT=pairs; DICT_GET=pairs_get; NUMBER=number)
                _tmp9 = pairs_get(t)
                if _tmp9 is None:
                    pairs[t] =  c
                else:
                    _tmp9 = _tmp9 + c
                    if type(_tmp9) is cls and _tmp9.head is NUMBER:
                        _tmp9 = _tmp9.data
                    if _tmp9:
                        if t.head is NUMBER:
                            del pairs[t]
                            z, sym = try_power(t.data, _tmp9)
                            if sym:
                                for t1, c1 in sym:
                                    #NEWINSTANCE(OBJ=tt; HEAD=NUMBER; DATA=t1)
                                    tt = cls(NUMBER, t1)
                                    #ADD_TERM_VALUE_DICT(DICT=pairs; DICT_GET=pairs_get; TERM=tt; VALUE=c1; SIGN=+; USIGN=)
                                    _tmp23 = pairs_get(tt)
                                    if _tmp23 is None:
                                        pairs[tt] =  c1
                                    else:
                                        _tmp23 = _tmp23 + c1
                                        if _tmp23:
                                            pairs[tt] = _tmp23
                                        else:
                                            del pairs[tt]
                            number = number * z
                        else:
                            pairs[t] = _tmp9
                    else:
                        del pairs[t]
            #CANONIZE_FACTORS_DICT(DICT=pairs; NUMBER=number)
            if not pairs:
                if number is 1:
                    return cls.one
                return number
            if len(pairs)==1:
               t, c = pairs.items()[0]
               if c==1:
                   if number==1:
                       return t
                   #RETURN_NEW(HEAD=TERMS; DATA={t: number})
                   #NEWINSTANCE(OBJ=_tmp37; HEAD=TERMS; DATA={t: number})
                   _tmp37 = cls(TERMS, {t: number})
                   return _tmp37
               if t==cls.one:
                   return number
            if number == 1:
                #RETURN_NEW(HEAD=FACTORS; DATA=pairs)
                #NEWINSTANCE(OBJ=_tmp51; HEAD=FACTORS; DATA=pairs)
                _tmp51 = cls(FACTORS, pairs)
                return _tmp51
            #NEWINSTANCE(OBJ=obj; HEAD=FACTORS; DATA=pairs)
            obj = cls(FACTORS, pairs)
            #RETURN_NEW(HEAD=TERMS; DATA={obj: number})
            #NEWINSTANCE(OBJ=_tmp72; HEAD=TERMS; DATA={obj: number})
            _tmp72 = cls(TERMS, {obj: number})
            return _tmp72
        elif rhead is NUMBER:
            return self # other must be one
        else:
            #MUL_FACTORS_SYMBOL(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
            pairs = dict(ldata)
            #MUL_DICT_SYMBOL(DICT=pairs; RHS=other; RHSDATA=rdata)
            #ADD_TERM_VALUE_DICT(TERM=other; VALUE=1; DICT=pairs; DICT_GET=pairs.get; SIGN=+; USIGN=)
            _tmp100 = pairs.get(other)
            if _tmp100 is None:
                pairs[other] =  1
            else:
                _tmp100 = _tmp100 + 1
                if _tmp100:
                    pairs[other] = _tmp100
                else:
                    del pairs[other]
            #CANONIZE_FACTORS_DICT1(DICT=pairs)
            if not pairs:
                return cls.one
            if len(pairs)==1:
               t, c = pairs.items()[0]
               if c==1:
                   return t
               if t==cls.one:
                   return t
            #RETURN_NEW(HEAD=FACTORS; DATA=pairs)
            #NEWINSTANCE(OBJ=_tmp114; HEAD=FACTORS; DATA=pairs)
            _tmp114 = cls(FACTORS, pairs)
            return _tmp114
    elif lhead is NUMBER:
        return other # self must be one
    else:
        if rhead is FACTORS:
            #MUL_SYMBOL_FACTORS(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
            #MUL_FACTORS_SYMBOL(LHS=other; LHSDATA=rdata; RHS=self; RHSDATA=ldata)
            pairs = dict(rdata)
            #MUL_DICT_SYMBOL(DICT=pairs; RHS=self; RHSDATA=ldata)
            #ADD_TERM_VALUE_DICT(TERM=self; VALUE=1; DICT=pairs; DICT_GET=pairs.get; SIGN=+; USIGN=)
            _tmp149 = pairs.get(self)
            if _tmp149 is None:
                pairs[self] =  1
            else:
                _tmp149 = _tmp149 + 1
                if _tmp149:
                    pairs[self] = _tmp149
                else:
                    del pairs[self]
            #CANONIZE_FACTORS_DICT1(DICT=pairs)
            if not pairs:
                return cls.one
            if len(pairs)==1:
               t, c = pairs.items()[0]
               if c==1:
                   return t
               if t==cls.one:
                   return t
            #RETURN_NEW(HEAD=FACTORS; DATA=pairs)
            #NEWINSTANCE(OBJ=_tmp163; HEAD=FACTORS; DATA=pairs)
            _tmp163 = cls(FACTORS, pairs)
            return _tmp163
        elif rhead is NUMBER:
            return self # other must be one
        else:
            #MUL_SYMBOL_SYMBOL(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
            if self == other:
                pairs = {self: 2}
            else:
                pairs = {self: 1, other: 1}
            #RETURN_NEW(HEAD=FACTORS; DATA=pairs)
            #NEWINSTANCE(OBJ=_tmp184; HEAD=FACTORS; DATA=pairs)
            _tmp184 = cls(FACTORS, pairs)
            return _tmp184

def neg_method(self, NUMBER=NUMBER, TERMS=TERMS):
    cls = type(self)
    lhead, ldata = self.pair
    if lhead is NUMBER:
        #NEG_NUMBER(OP=self; OPDATA=ldata)
        #RETURN_NEW(HEAD=NUMBER; DATA=-ldata)
        #NEWINSTANCE(OBJ=_tmp205; HEAD=NUMBER; DATA=-ldata)
        _tmp205 = cls(NUMBER, -ldata)
        return _tmp205
    elif lhead is TERMS:
        #NEG_TERMS(OP=self; OPDATA=ldata)
        op_pairs = ldata
        if len(op_pairs)==1:
            t, c = op_pairs.items()[0]
            c = -c
            if c==1:
                return t
            #RETURN_NEW(HEAD=TERMS; DATA={t:c})
            #NEWINSTANCE(OBJ=_tmp226; HEAD=TERMS; DATA={t:c})
            _tmp226 = cls(TERMS, {t:c})
            return _tmp226
        #NEG_DICT_VALUES(DICT_IN=self.data; DICT_OUT=pairs)
        pairs = dict([(t, -c) for t,c in self.data.iteritems()])
        #RETURN_NEW(HEAD=TERMS; DATA=pairs)
        #NEWINSTANCE(OBJ=_tmp247; HEAD=TERMS; DATA=pairs)
        _tmp247 = cls(TERMS, pairs)
        return _tmp247
    else:
        #NEG_SYMBOL(OP=self; OPDATA=ldata)
        #RETURN_NEW(HEAD=TERMS; DATA={self: -1})
        #NEWINSTANCE(OBJ=_tmp268; HEAD=TERMS; DATA={self: -1})
        _tmp268 = cls(TERMS, {self: -1})
        return _tmp268

def rsub_method(self, other, NUMBER=NUMBER, TERMS=TERMS, FACTORS=FACTORS):
    cls = type(self)
    lhead, ldata = self.pair
    if isinstance(other, cls.coefftypes):
        if lhead is NUMBER:
            #SUB_VALUE_NUMBER(VALUE=other; RHS=self; RHSDATA=ldata)
            #RETURN_NEW(HEAD=NUMBER; DATA=other - ldata)
            #NEWINSTANCE(OBJ=_tmp289; HEAD=NUMBER; DATA=other - ldata)
            _tmp289 = cls(NUMBER, other - ldata)
            return _tmp289
        elif lhead is TERMS:
            #SUB_VALUE_TERMS(VALUE=other; RHS=self; RHSDATA=ldata)
            _tmp303 = other
            if not _tmp303:
                #NEG_TERMS(OP=self; OPDATA=ldata)
                op_pairs = ldata
                if len(op_pairs)==1:
                    t, c = op_pairs.items()[0]
                    c = -c
                    if c==1:
                        return t
                    #RETURN_NEW(HEAD=TERMS; DATA={t:c})
                    #NEWINSTANCE(OBJ=_tmp317; HEAD=TERMS; DATA={t:c})
                    _tmp317 = cls(TERMS, {t:c})
                    return _tmp317
                #NEG_DICT_VALUES(DICT_IN=self.data; DICT_OUT=pairs)
                pairs = dict([(t, -c) for t,c in self.data.iteritems()])
                #RETURN_NEW(HEAD=TERMS; DATA=pairs)
                #NEWINSTANCE(OBJ=_tmp338; HEAD=TERMS; DATA=pairs)
                _tmp338 = cls(TERMS, pairs)
                return _tmp338
            #NEG_DICT_VALUES(DICT_IN=ldata; DICT_OUT=pairs)
            pairs = dict([(t, -c) for t,c in ldata.iteritems()])
            #ADD_VALUE_DICT(DICT=pairs; VALUE=_tmp303)
            #ADD_TERM_VALUE_DICT(TERM=cls.one; VALUE=_tmp303; DICT=pairs; DICT_GET=pairs.get; SIGN=+; USIGN=)
            _tmp366 = pairs.get(cls.one)
            if _tmp366 is None:
                pairs[cls.one] =  _tmp303
            else:
                _tmp366 = _tmp366 + _tmp303
                if _tmp366:
                    pairs[cls.one] = _tmp366
                else:
                    del pairs[cls.one]
            #RETURN_NEW(HEAD=TERMS; DATA=pairs)
            #NEWINSTANCE(OBJ=_tmp373; HEAD=TERMS; DATA=pairs)
            _tmp373 = cls(TERMS, pairs)
            return _tmp373
        else:
            #SUB_VALUE_SYMBOL(VALUE=other; RHS=self; RHSDATA=ldata)
            _tmp387 = other
            if not _tmp387:
                #RETURN_NEW(HEAD=TERMS; DATA={self: -1})
                #NEWINSTANCE(OBJ=_tmp394; HEAD=TERMS; DATA={self: -1})
                _tmp394 = cls(TERMS, {self: -1})
                return _tmp394
            #RETURN_NEW(HEAD=TERMS; DATA={cls.one: _tmp387, self: -1})
            #NEWINSTANCE(OBJ=_tmp408; HEAD=TERMS; DATA={cls.one: _tmp387, self: -1})
            _tmp408 = cls(TERMS, {cls.one: _tmp387, self: -1})
            return _tmp408
    other = cls.convert(other, False)
    if other is NotImplemented:
        return other
    return other - self

def rdiv_method(self, other, NUMBER=NUMBER, TERMS=TERMS, FACTORS=FACTORS):
    cls = type(self)
    lhead, ldata = self.pair
    if isinstance(other, cls.coefftypes):
        if lhead is NUMBER:
            #DIV_VALUE_NUMBER(VALUE=other; RHS=self; RHSDATA=ldata)
            #RETURN_NEW2(HEAD=NUMBER; DATA=div(other, self.data, cls))
            _tmp429 = div(other, self.data, cls)
            if isinstance(_tmp429, Infinity):
                return _tmp429
            #RETURN_NEW(HEAD=NUMBER; DATA=_tmp429)
            #NEWINSTANCE(OBJ=_tmp436; HEAD=NUMBER; DATA=_tmp429)
            _tmp436 = cls(NUMBER, _tmp429)
            return _tmp436
        elif lhead is TERMS:
            #DIV_VALUE_TERMS(VALUE=other; RHS=self; RHSDATA=ldata)
            _tmp450 = other
            if not _tmp450:
                return cls.zero
            pairs = self.data
            if len(pairs)==1:
                t, c = pairs.items()[0]
                c = div(other, c, cls)
                t = 1/t
                if c==1:
                    return t
                if t==cls.one:
                    return cls.convert(c)
                #RETURN_NEW(HEAD=TERMS; DATA={t: c})
                #NEWINSTANCE(OBJ=_tmp457; HEAD=TERMS; DATA={t: c})
                _tmp457 = cls(TERMS, {t: c})
                return _tmp457
            #NEWINSTANCE(OBJ=_tmp450; HEAD=FACTORS; DATA={self: -1})
            _tmp450 = cls(FACTORS, {self: -1})
            if other==1:
                return _tmp450
            #RETURN_NEW(HEAD=TERMS; DATA={_tmp450: other})
            #NEWINSTANCE(OBJ=_tmp478; HEAD=TERMS; DATA={_tmp450: other})
            _tmp478 = cls(TERMS, {_tmp450: other})
            return _tmp478
        elif lhead is FACTORS:
            #DIV_VALUE_FACTORS(VALUE=other; RHS=self; RHSDATA=ldata)
            
            pairs = ldata
            if len(pairs)==1:
                t, c = pairs.items()[0]
                c = -c
                if c==1:
                    return t * other
                new_pairs = {t: c}
            else:
                #NEG_DICT_VALUES(DICT_IN=pairs; DICT_OUT=new_pairs)
                new_pairs = dict([(t, -c) for t,c in pairs.iteritems()])
            #NEWINSTANCE(OBJ=_tmp492; HEAD=FACTORS; DATA=new_pairs)
            _tmp492 = cls(FACTORS, new_pairs)
            if other==1:
                return _tmp492
            #RETURN_NEW(HEAD=TERMS; DATA={_tmp492: other})
            #NEWINSTANCE(OBJ=_tmp513; HEAD=TERMS; DATA={_tmp492: other})
            _tmp513 = cls(TERMS, {_tmp492: other})
            return _tmp513
        else:
            #DIV_VALUE_SYMBOL(VALUE=other; RHS=self; RHSDATA=ldata)
            _tmp527 = other
            if not _tmp527:
                return cls.zero
            #NEWINSTANCE(OBJ=obj2; HEAD=FACTORS; DATA={self: -1})
            obj2 = cls(FACTORS, {self: -1})
            if _tmp527==1:
                return obj2
            #RETURN_NEW(HEAD=TERMS; DATA={obj2: _tmp527})
            #NEWINSTANCE(OBJ=_tmp541; HEAD=TERMS; DATA={obj2: _tmp527})
            _tmp541 = cls(TERMS, {obj2: _tmp527})
            return _tmp541
    other = cls.convert(other, False)
    if other is NotImplemented:
        return other
    return other / self

def pow_method(self, other, z = None, NUMBER=NUMBER, TERMS=TERMS, FACTORS=FACTORS):
    cls = type(self)
    lhead, ldata = self.pair
    type_other = type(other)
    if type_other is cls:
        rhead, rdata = other.pair
        if rhead is NUMBER:
            other = rdata
        type_other = type(other)
    if type_other is int or type_other is long:
        if not other:
            return cls.one
        if other==1:
            return self
        if lhead is NUMBER:
            #POW_NUMBER_INT(VALUE=other; LHS=self; LHSDATA=ldata)
            if other < 0:
                #RETURN_NEW(HEAD=NUMBER; DATA=div(1, (ldata)**(-other), cls))
                #NEWINSTANCE(OBJ=_tmp562; HEAD=NUMBER; DATA=div(1, (ldata)**(-other), cls))
                _tmp562 = cls(NUMBER, div(1, (ldata)**(-other), cls))
                return _tmp562
            #RETURN_NEW(HEAD=NUMBER; DATA=(ldata)**(other))
            #NEWINSTANCE(OBJ=_tmp576; HEAD=NUMBER; DATA=(ldata)**(other))
            _tmp576 = cls(NUMBER, (ldata)**(other))
            return _tmp576
        elif lhead is TERMS:
            #POW_TERMS_INT(VALUE=other; LHS=self; LHSDATA=ldata)
            pairs = ldata
            if len(pairs)==1:
                t,c = pairs.items()[0]
                if other < 0:
                    c = div(1, c**(-other), cls)
                else:
                    c = c ** (other)
                t = t**(other)
                if c==1:
                    return t
                #RETURN_NEW(HEAD=TERMS; DATA={t:c})
                #NEWINSTANCE(OBJ=_tmp597; HEAD=TERMS; DATA={t:c})
                _tmp597 = cls(TERMS, {t:c})
                return _tmp597
            #RETURN_NEW(HEAD=FACTORS; DATA={self: other})
            #NEWINSTANCE(OBJ=_tmp611; HEAD=FACTORS; DATA={self: other})
            _tmp611 = cls(FACTORS, {self: other})
            return _tmp611
        elif lhead is FACTORS:
            #POW_FACTORS_INT(VALUE=other; LHS=self; LHSDATA=ldata)
            #MUL_DICT_VALUES(DICT_IN=ldata; DICT_OUT=pairs; OP=other)
            pairs = dict([(t, c*other) for t,c in ldata.iteritems()])
            if len(pairs)==1:
                t, c = pairs.items()[0]
                if c==1:
                    return t
            #RETURN_NEW(HEAD=FACTORS; DATA=pairs)
            #NEWINSTANCE(OBJ=_tmp639; HEAD=FACTORS; DATA=pairs)
            _tmp639 = cls(FACTORS, pairs)
            return _tmp639
        else:
            #POW_SYMBOL_INT(VALUE=other; LHS=self; LHSDATA=ldata)
            #RETURN_NEW(HEAD=FACTORS; DATA={self: other})
            #NEWINSTANCE(OBJ=_tmp660; HEAD=FACTORS; DATA={self: other})
            _tmp660 = cls(FACTORS, {self: other})
            return _tmp660
    if lhead is NUMBER and isinstance(other, cls.exptypes):
        #POW_NUMBER_VALUE(VALUE=other; LHS=self; LHSDATA=ldata)
        z, sym = try_power(ldata, other)
        if not sym:
            #RETURN_NEW(HEAD=NUMBER; DATA=z)
            #NEWINSTANCE(OBJ=_tmp681; HEAD=NUMBER; DATA=z)
            _tmp681 = cls(NUMBER, z)
            return _tmp681
        factors = {}
        for t,c in sym:
            factors[cls.convert(t)] = c
        #NEWINSTANCE(OBJ=_tmp674; HEAD=FACTORS; DATA=factors)
        _tmp674 = cls(FACTORS, factors)
        if z==1:
            return _tmp674
        #RETURN_NEW(HEAD=TERMS; DATA={_tmp674: z})
        #NEWINSTANCE(OBJ=_tmp702; HEAD=TERMS; DATA={_tmp674: z})
        _tmp702 = cls(TERMS, {_tmp674: z})
        return _tmp702
    if type_other is FractionTuple:
        if lhead is TERMS:
            #POW_TERMS_FRAC(VALUE=other; LHS=self; LHSDATA=ldata)
            pairs = ldata
            if len(pairs)==1:
                t, c = pairs.items()[0]
                if isinstance(c, numbertypes) and not c==-1:
                    if c < 0:
                        z, sym = try_power(-c, other)
                        factors = {-t: other}
                    else:
                        z, sym = try_power(c, other)
                        factors = {t: other}
                    for t,c in sym:
                        factors[cls.convert(t)] = c
                    #NEWINSTANCE(OBJ=_tmp716; HEAD=FACTORS; DATA=factors)
                    _tmp716 = cls(FACTORS, factors)
                    if z==1:
                        return _tmp716
                    #RETURN_NEW(HEAD=TERMS; DATA={_tmp716: z})
                    #NEWINSTANCE(OBJ=_tmp730; HEAD=TERMS; DATA={_tmp716: z})
                    _tmp730 = cls(TERMS, {_tmp716: z})
                    return _tmp730
            #RETURN_NEW(HEAD=FACTORS; DATA={self: other})
            #NEWINSTANCE(OBJ=_tmp744; HEAD=FACTORS; DATA={self: other})
            _tmp744 = cls(FACTORS, {self: other})
            return _tmp744
        else:
            #POW_SYMBOL_FRAC(VALUE=other; LHS=self; LHSDATA=ldata)
            #RETURN_NEW(HEAD=FACTORS; DATA={self: other})
            #NEWINSTANCE(OBJ=_tmp765; HEAD=FACTORS; DATA={self: other})
            _tmp765 = cls(FACTORS, {self: other})
            return _tmp765
    if type_other is cls or isinstance(other, cls.exptypes):
        if lhead is FACTORS:
            #POW_FACTORS_SYMBOL(LHS=self; LHSDATA=ldata; RHS=other)
            pairs = ldata
            if len(pairs)==1:
                t, c = pairs.items()[0]
                tc = type(c)
                if tc is int or tc is long:
                    #RETURN_NEW(HEAD=FACTORS; DATA={t: other * c})
                    #NEWINSTANCE(OBJ=_tmp786; HEAD=FACTORS; DATA={t: other * c})
                    _tmp786 = cls(FACTORS, {t: other * c})
                    return _tmp786
            #RETURN_NEW(HEAD=FACTORS; DATA={self: other})
            #NEWINSTANCE(OBJ=_tmp800; HEAD=FACTORS; DATA={self: other})
            _tmp800 = cls(FACTORS, {self: other})
            return _tmp800
        #RETURN_NEW(HEAD=FACTORS; DATA={self: other})
        #NEWINSTANCE(OBJ=_tmp814; HEAD=FACTORS; DATA={self: other})
        _tmp814 = cls(FACTORS, {self: other})
        return _tmp814
    return NotImplemented

def add_method(self, other, NUMBER=NUMBER, TERMS=TERMS, FACTORS=FACTORS):
    cls = type(self)
    lhead, ldata = self.pair
    if type(other) is not cls:
        if isinstance(other, cls.coefftypes):
            if lhead is NUMBER:
                #ADD_NUMBER_VALUE(VALUE=other; LHS=self; LHSDATA=ldata)
                #RETURN_NEW(HEAD=NUMBER; DATA=ldata + other)
                #NEWINSTANCE(OBJ=_tmp835; HEAD=NUMBER; DATA=ldata + other)
                _tmp835 = cls(NUMBER, ldata + other)
                return _tmp835
            elif lhead is TERMS:
                #ADD_TERMS_VALUE(VALUE=other; LHS=self; LHSDATA=ldata)
                #ADD_VALUE_TERMS(VALUE=other; RHS=self; RHSDATA=ldata)
                _tmp856 = other
                if not _tmp856:
                    return self
                pairs = dict(ldata)
                #ADD_VALUE_DICT(DICT=pairs; VALUE=_tmp856)
                #ADD_TERM_VALUE_DICT(TERM=cls.one; VALUE=_tmp856; DICT=pairs; DICT_GET=pairs.get; SIGN=+; USIGN=)
                _tmp870 = pairs.get(cls.one)
                if _tmp870 is None:
                    pairs[cls.one] =  _tmp856
                else:
                    _tmp870 = _tmp870 + _tmp856
                    if _tmp870:
                        pairs[cls.one] = _tmp870
                    else:
                        del pairs[cls.one]
                #RETURN_NEW(HEAD=TERMS; DATA=pairs)
                #NEWINSTANCE(OBJ=_tmp877; HEAD=TERMS; DATA=pairs)
                _tmp877 = cls(TERMS, pairs)
                return _tmp877
            else:
                #ADD_SYMBOL_VALUE(VALUE=other; LHS=self; LHSDATA=ldata)
                #ADD_VALUE_SYMBOL(VALUE=other; RHS=self; RHSDATA=ldata)
                _tmp898 = other
                if not _tmp898:
                    return self
                #RETURN_NEW(HEAD=TERMS; DATA={cls.one: _tmp898, self: 1})
                #NEWINSTANCE(OBJ=_tmp905; HEAD=TERMS; DATA={cls.one: _tmp898, self: 1})
                _tmp905 = cls(TERMS, {cls.one: _tmp898, self: 1})
                return _tmp905
        other = cls.convert(other, False)
        if other is NotImplemented:
            return other
    rhead, rdata = other.pair
    if lhead is NUMBER:
        if rhead is NUMBER:
            #ADD_NUMBER_NUMBER(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
            #ADD_VALUE_NUMBER(VALUE=ldata; RHS=other; RHSDATA=rdata)
            #RETURN_NEW(HEAD=NUMBER; DATA=ldata + rdata)
            #NEWINSTANCE(OBJ=_tmp933; HEAD=NUMBER; DATA=ldata + rdata)
            _tmp933 = cls(NUMBER, ldata + rdata)
            return _tmp933
        elif rhead is TERMS:
            #ADD_NUMBER_TERMS(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
            #ADD_VALUE_TERMS(VALUE=ldata; RHS=other; RHSDATA=rdata)
            _tmp954 = ldata
            if not _tmp954:
                return other
            pairs = dict(rdata)
            #ADD_VALUE_DICT(DICT=pairs; VALUE=_tmp954)
            #ADD_TERM_VALUE_DICT(TERM=cls.one; VALUE=_tmp954; DICT=pairs; DICT_GET=pairs.get; SIGN=+; USIGN=)
            _tmp968 = pairs.get(cls.one)
            if _tmp968 is None:
                pairs[cls.one] =  _tmp954
            else:
                _tmp968 = _tmp968 + _tmp954
                if _tmp968:
                    pairs[cls.one] = _tmp968
                else:
                    del pairs[cls.one]
            #RETURN_NEW(HEAD=TERMS; DATA=pairs)
            #NEWINSTANCE(OBJ=_tmp975; HEAD=TERMS; DATA=pairs)
            _tmp975 = cls(TERMS, pairs)
            return _tmp975
        else:
            #ADD_NUMBER_SYMBOL(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
            #ADD_VALUE_SYMBOL(VALUE=ldata; RHS=other; RHSDATA=rdata)
            _tmp996 = ldata
            if not _tmp996:
                return other
            #RETURN_NEW(HEAD=TERMS; DATA={cls.one: _tmp996, other: 1})
            #NEWINSTANCE(OBJ=_tmp1003; HEAD=TERMS; DATA={cls.one: _tmp996, other: 1})
            _tmp1003 = cls(TERMS, {cls.one: _tmp996, other: 1})
            return _tmp1003
    elif lhead is TERMS:
        if rhead is NUMBER:
            #ADD_TERMS_NUMBER(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
            #ADD_TERMS_VALUE(VALUE=rdata; LHS=self; LHSDATA=ldata)
            #ADD_VALUE_TERMS(VALUE=rdata; RHS=self; RHSDATA=ldata)
            _tmp1031 = rdata
            if not _tmp1031:
                return self
            pairs = dict(ldata)
            #ADD_VALUE_DICT(DICT=pairs; VALUE=_tmp1031)
            #ADD_TERM_VALUE_DICT(TERM=cls.one; VALUE=_tmp1031; DICT=pairs; DICT_GET=pairs.get; SIGN=+; USIGN=)
            _tmp1045 = pairs.get(cls.one)
            if _tmp1045 is None:
                pairs[cls.one] =  _tmp1031
            else:
                _tmp1045 = _tmp1045 + _tmp1031
                if _tmp1045:
                    pairs[cls.one] = _tmp1045
                else:
                    del pairs[cls.one]
            #RETURN_NEW(HEAD=TERMS; DATA=pairs)
            #NEWINSTANCE(OBJ=_tmp1052; HEAD=TERMS; DATA=pairs)
            _tmp1052 = cls(TERMS, pairs)
            return _tmp1052
        elif rhead is TERMS:
            #ADD_TERMS_TERMS(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
            pairs = dict(ldata)
            pairs_get = pairs.get
            for t,c in rdata.iteritems():
                #ADD_TERM_VALUE_DICT(TERM=t; VALUE=c; DICT=pairs; DICT_GET=pairs_get; SIGN=+; USIGN=)
                _tmp1073 = pairs_get(t)
                if _tmp1073 is None:
                    pairs[t] =  c
                else:
                    _tmp1073 = _tmp1073 + c
                    if _tmp1073:
                        pairs[t] = _tmp1073
                    else:
                        del pairs[t]
            #CANONIZE_TERMS_DICT(DICT=pairs)
            if not pairs:
                return cls.zero
            if len(pairs)==1:
               t, c = pairs.items()[0]
               if c==1:
                   return t
               if t==cls.one:
                   return cls.convert(c)
            #RETURN_NEW(HEAD=TERMS; DATA=pairs)
            #NEWINSTANCE(OBJ=_tmp1087; HEAD=TERMS; DATA=pairs)
            _tmp1087 = cls(TERMS, pairs)
            return _tmp1087
        else:
            #ADD_TERMS_SYMBOL(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
            pairs = dict(ldata)
            #ADD_TERM_VALUE_DICT(TERM=other; VALUE=1; DICT=pairs; DICT_GET=pairs.get; SIGN=+; USIGN=)
            _tmp1108 = pairs.get(other)
            if _tmp1108 is None:
                pairs[other] =  1
            else:
                _tmp1108 = _tmp1108 + 1
                if _tmp1108:
                    pairs[other] = _tmp1108
                else:
                    del pairs[other]
            #CANONIZE_TERMS_DICT(DICT=pairs)
            if not pairs:
                return cls.zero
            if len(pairs)==1:
               t, c = pairs.items()[0]
               if c==1:
                   return t
               if t==cls.one:
                   return cls.convert(c)
            #RETURN_NEW(HEAD=TERMS; DATA=pairs)
            #NEWINSTANCE(OBJ=_tmp1122; HEAD=TERMS; DATA=pairs)
            _tmp1122 = cls(TERMS, pairs)
            return _tmp1122
    else:
        if rhead is NUMBER:
            #ADD_SYMBOL_NUMBER(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
            #ADD_SYMBOL_VALUE(VALUE=rdata; LHS=self; LHSDATA=ldata)
            #ADD_VALUE_SYMBOL(VALUE=rdata; RHS=self; RHSDATA=ldata)
            _tmp1150 = rdata
            if not _tmp1150:
                return self
            #RETURN_NEW(HEAD=TERMS; DATA={cls.one: _tmp1150, self: 1})
            #NEWINSTANCE(OBJ=_tmp1157; HEAD=TERMS; DATA={cls.one: _tmp1150, self: 1})
            _tmp1157 = cls(TERMS, {cls.one: _tmp1150, self: 1})
            return _tmp1157
        elif rhead is TERMS:
            #ADD_SYMBOL_TERMS(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
            #ADD_TERMS_SYMBOL(LHS=other; LHSDATA=rdata; RHS=self; RHSDATA=ldata)
            pairs = dict(rdata)
            #ADD_TERM_VALUE_DICT(TERM=self; VALUE=1; DICT=pairs; DICT_GET=pairs.get; SIGN=+; USIGN=)
            _tmp1185 = pairs.get(self)
            if _tmp1185 is None:
                pairs[self] =  1
            else:
                _tmp1185 = _tmp1185 + 1
                if _tmp1185:
                    pairs[self] = _tmp1185
                else:
                    del pairs[self]
            #CANONIZE_TERMS_DICT(DICT=pairs)
            if not pairs:
                return cls.zero
            if len(pairs)==1:
               t, c = pairs.items()[0]
               if c==1:
                   return t
               if t==cls.one:
                   return cls.convert(c)
            #RETURN_NEW(HEAD=TERMS; DATA=pairs)
            #NEWINSTANCE(OBJ=_tmp1199; HEAD=TERMS; DATA=pairs)
            _tmp1199 = cls(TERMS, pairs)
            return _tmp1199
        else:
            #ADD_SYMBOL_SYMBOL(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
            if self == other:
                pairs = {self: 2}
            else:
                pairs = {self: 1, other: 1}
            #RETURN_NEW(HEAD=TERMS; DATA=pairs)
            #NEWINSTANCE(OBJ=_tmp1220; HEAD=TERMS; DATA=pairs)
            _tmp1220 = cls(TERMS, pairs)
            return _tmp1220

def sub_method(self, other, NUMBER=NUMBER, TERMS=TERMS, FACTORS=FACTORS):
    cls = type(self)
    lhead, ldata = self.pair
    if type(other) is not cls:
        if isinstance(other, cls.coefftypes):
            if lhead is NUMBER:
                #SUB_NUMBER_VALUE(VALUE=other; LHS=self; LHSDATA=ldata)
                #RETURN_NEW(HEAD=NUMBER; DATA=ldata - other)
                #NEWINSTANCE(OBJ=_tmp1241; HEAD=NUMBER; DATA=ldata - other)
                _tmp1241 = cls(NUMBER, ldata - other)
                return _tmp1241
            elif lhead is TERMS:
                #SUB_TERMS_VALUE(VALUE=other; LHS=self; LHSDATA=ldata)
                #ADD_VALUE_TERMS(VALUE=-other; RHS=self; RHSDATA=ldata)
                _tmp1262 = -other
                if not _tmp1262:
                    return self
                pairs = dict(ldata)
                #ADD_VALUE_DICT(DICT=pairs; VALUE=_tmp1262)
                #ADD_TERM_VALUE_DICT(TERM=cls.one; VALUE=_tmp1262; DICT=pairs; DICT_GET=pairs.get; SIGN=+; USIGN=)
                _tmp1276 = pairs.get(cls.one)
                if _tmp1276 is None:
                    pairs[cls.one] =  _tmp1262
                else:
                    _tmp1276 = _tmp1276 + _tmp1262
                    if _tmp1276:
                        pairs[cls.one] = _tmp1276
                    else:
                        del pairs[cls.one]
                #RETURN_NEW(HEAD=TERMS; DATA=pairs)
                #NEWINSTANCE(OBJ=_tmp1283; HEAD=TERMS; DATA=pairs)
                _tmp1283 = cls(TERMS, pairs)
                return _tmp1283
            else:
                #SUB_SYMBOL_VALUE(VALUE=other; LHS=self; LHSDATA=ldata)
                #ADD_SYMBOL_VALUE(OBJ=obj; LHS=self; LHSDATA=ldata; VALUE=-other)
                #ADD_VALUE_SYMBOL(VALUE=-other; RHS=self; RHSDATA=ldata)
                _tmp1311 = -other
                if not _tmp1311:
                    return self
                #RETURN_NEW(HEAD=TERMS; DATA={cls.one: _tmp1311, self: 1})
                #NEWINSTANCE(OBJ=_tmp1318; HEAD=TERMS; DATA={cls.one: _tmp1311, self: 1})
                _tmp1318 = cls(TERMS, {cls.one: _tmp1311, self: 1})
                return _tmp1318
        other = cls.convert(other, False)
        if other is NotImplemented:
            return other
    rhead, rdata = other.pair
    if lhead is NUMBER:
        if rhead is NUMBER:
            #SUB_NUMBER_NUMBER(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
            #SUB_VALUE_NUMBER(VALUE=ldata; RHS=other; RHSDATA=rdata)
            #RETURN_NEW(HEAD=NUMBER; DATA=ldata - rdata)
            #NEWINSTANCE(OBJ=_tmp1346; HEAD=NUMBER; DATA=ldata - rdata)
            _tmp1346 = cls(NUMBER, ldata - rdata)
            return _tmp1346
        elif rhead is TERMS:
            #SUB_NUMBER_TERMS(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
            #SUB_VALUE_TERMS(VALUE=ldata; RHS=other; RHSDATA=rdata)
            _tmp1367 = ldata
            if not _tmp1367:
                #NEG_TERMS(OP=other; OPDATA=rdata)
                op_pairs = rdata
                if len(op_pairs)==1:
                    t, c = op_pairs.items()[0]
                    c = -c
                    if c==1:
                        return t
                    #RETURN_NEW(HEAD=TERMS; DATA={t:c})
                    #NEWINSTANCE(OBJ=_tmp1381; HEAD=TERMS; DATA={t:c})
                    _tmp1381 = cls(TERMS, {t:c})
                    return _tmp1381
                #NEG_DICT_VALUES(DICT_IN=other.data; DICT_OUT=pairs)
                pairs = dict([(t, -c) for t,c in other.data.iteritems()])
                #RETURN_NEW(HEAD=TERMS; DATA=pairs)
                #NEWINSTANCE(OBJ=_tmp1402; HEAD=TERMS; DATA=pairs)
                _tmp1402 = cls(TERMS, pairs)
                return _tmp1402
            #NEG_DICT_VALUES(DICT_IN=rdata; DICT_OUT=pairs)
            pairs = dict([(t, -c) for t,c in rdata.iteritems()])
            #ADD_VALUE_DICT(DICT=pairs; VALUE=_tmp1367)
            #ADD_TERM_VALUE_DICT(TERM=cls.one; VALUE=_tmp1367; DICT=pairs; DICT_GET=pairs.get; SIGN=+; USIGN=)
            _tmp1430 = pairs.get(cls.one)
            if _tmp1430 is None:
                pairs[cls.one] =  _tmp1367
            else:
                _tmp1430 = _tmp1430 + _tmp1367
                if _tmp1430:
                    pairs[cls.one] = _tmp1430
                else:
                    del pairs[cls.one]
            #RETURN_NEW(HEAD=TERMS; DATA=pairs)
            #NEWINSTANCE(OBJ=_tmp1437; HEAD=TERMS; DATA=pairs)
            _tmp1437 = cls(TERMS, pairs)
            return _tmp1437
        else:
            #SUB_NUMBER_SYMBOL(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
            #SUB_VALUE_SYMBOL(VALUE=ldata; RHS=other; RHSDATA=rdata)
            _tmp1458 = ldata
            if not _tmp1458:
                #RETURN_NEW(HEAD=TERMS; DATA={other: -1})
                #NEWINSTANCE(OBJ=_tmp1465; HEAD=TERMS; DATA={other: -1})
                _tmp1465 = cls(TERMS, {other: -1})
                return _tmp1465
            #RETURN_NEW(HEAD=TERMS; DATA={cls.one: _tmp1458, other: -1})
            #NEWINSTANCE(OBJ=_tmp1479; HEAD=TERMS; DATA={cls.one: _tmp1458, other: -1})
            _tmp1479 = cls(TERMS, {cls.one: _tmp1458, other: -1})
            return _tmp1479
    elif lhead is TERMS:
        if rhead is NUMBER:
            #SUB_TERMS_NUMBER(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
            #SUB_TERMS_VALUE(VALUE=rdata; LHS=self; LHSDATA=ldata)
            #ADD_VALUE_TERMS(VALUE=-rdata; RHS=self; RHSDATA=ldata)
            _tmp1507 = -rdata
            if not _tmp1507:
                return self
            pairs = dict(ldata)
            #ADD_VALUE_DICT(DICT=pairs; VALUE=_tmp1507)
            #ADD_TERM_VALUE_DICT(TERM=cls.one; VALUE=_tmp1507; DICT=pairs; DICT_GET=pairs.get; SIGN=+; USIGN=)
            _tmp1521 = pairs.get(cls.one)
            if _tmp1521 is None:
                pairs[cls.one] =  _tmp1507
            else:
                _tmp1521 = _tmp1521 + _tmp1507
                if _tmp1521:
                    pairs[cls.one] = _tmp1521
                else:
                    del pairs[cls.one]
            #RETURN_NEW(HEAD=TERMS; DATA=pairs)
            #NEWINSTANCE(OBJ=_tmp1528; HEAD=TERMS; DATA=pairs)
            _tmp1528 = cls(TERMS, pairs)
            return _tmp1528
        elif rhead is TERMS:
            #SUB_TERMS_TERMS(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
            pairs = dict(ldata)
            pairs_get = pairs.get
            for t,c in rdata.iteritems():
                #ADD_TERM_VALUE_DICT(TERM=t; VALUE=-c; DICT=pairs; DICT_GET=pairs_get; SIGN=+; USIGN=)
                _tmp1549 = pairs_get(t)
                if _tmp1549 is None:
                    pairs[t] =  -c
                else:
                    _tmp1549 = _tmp1549 + -c
                    if _tmp1549:
                        pairs[t] = _tmp1549
                    else:
                        del pairs[t]
            #CANONIZE_TERMS_DICT(DICT=pairs)
            if not pairs:
                return cls.zero
            if len(pairs)==1:
               t, c = pairs.items()[0]
               if c==1:
                   return t
               if t==cls.one:
                   return cls.convert(c)
            #RETURN_NEW(HEAD=TERMS; DATA=pairs)
            #NEWINSTANCE(OBJ=_tmp1563; HEAD=TERMS; DATA=pairs)
            _tmp1563 = cls(TERMS, pairs)
            return _tmp1563
        else:
            #SUB_TERMS_SYMBOL(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
            pairs = dict(ldata)
            #ADD_TERM_VALUE_DICT(TERM=other; VALUE=-1; DICT=pairs; DICT_GET=pairs.get; SIGN=+; USIGN=)
            _tmp1584 = pairs.get(other)
            if _tmp1584 is None:
                pairs[other] =  -1
            else:
                _tmp1584 = _tmp1584 + -1
                if _tmp1584:
                    pairs[other] = _tmp1584
                else:
                    del pairs[other]
            #CANONIZE_TERMS_DICT(DICT=pairs)
            if not pairs:
                return cls.zero
            if len(pairs)==1:
               t, c = pairs.items()[0]
               if c==1:
                   return t
               if t==cls.one:
                   return cls.convert(c)
            #RETURN_NEW(HEAD=TERMS; DATA=pairs)
            #NEWINSTANCE(OBJ=_tmp1598; HEAD=TERMS; DATA=pairs)
            _tmp1598 = cls(TERMS, pairs)
            return _tmp1598
    else:
        if rhead is NUMBER:
            #SUB_SYMBOL_NUMBER(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
            #SUB_SYMBOL_VALUE(VALUE=rdata; LHS=self; LHSDATA=ldata)
            #ADD_SYMBOL_VALUE(OBJ=obj; LHS=self; LHSDATA=ldata; VALUE=-rdata)
            #ADD_VALUE_SYMBOL(VALUE=-rdata; RHS=self; RHSDATA=ldata)
            _tmp1633 = -rdata
            if not _tmp1633:
                return self
            #RETURN_NEW(HEAD=TERMS; DATA={cls.one: _tmp1633, self: 1})
            #NEWINSTANCE(OBJ=_tmp1640; HEAD=TERMS; DATA={cls.one: _tmp1633, self: 1})
            _tmp1640 = cls(TERMS, {cls.one: _tmp1633, self: 1})
            return _tmp1640
        elif rhead is TERMS:
            #SUB_SYMBOL_TERMS(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
            #NEG_DICT_VALUES(DICT_IN=rdata; DICT_OUT=pairs)
            pairs = dict([(t, -c) for t,c in rdata.iteritems()])
            #ADD_TERM_VALUE_DICT(TERM=self; VALUE=1; DICT=pairs; DICT_GET=pairs.get; SIGN=+; USIGN=)
            _tmp1668 = pairs.get(self)
            if _tmp1668 is None:
                pairs[self] =  1
            else:
                _tmp1668 = _tmp1668 + 1
                if _tmp1668:
                    pairs[self] = _tmp1668
                else:
                    del pairs[self]
            #CANONIZE_TERMS_DICT(DICT=pairs)
            if not pairs:
                return cls.zero
            if len(pairs)==1:
               t, c = pairs.items()[0]
               if c==1:
                   return t
               if t==cls.one:
                   return cls.convert(c)
            #RETURN_NEW(HEAD=TERMS; DATA=pairs)
            #NEWINSTANCE(OBJ=_tmp1682; HEAD=TERMS; DATA=pairs)
            _tmp1682 = cls(TERMS, pairs)
            return _tmp1682
        else:
            #SUB_SYMBOL_SYMBOL(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
            if self == other:
                return cls.zero
            #RETURN_NEW(HEAD=TERMS; DATA={self: 1, other: -1})
            #NEWINSTANCE(OBJ=_tmp1703; HEAD=TERMS; DATA={self: 1, other: -1})
            _tmp1703 = cls(TERMS, {self: 1, other: -1})
            return _tmp1703

def mul_method(self, other, NUMBER=NUMBER, TERMS=TERMS, FACTORS=FACTORS):
    cls = type(self)
    lhead, ldata = self.pair
    if type(other) is not cls:
        if isinstance(other, cls.coefftypes):
            if lhead is NUMBER:
                #MUL_NUMBER_VALUE(VALUE=other; LHS=self; LHSDATA=ldata)
                #RETURN_NEW(HEAD=NUMBER; DATA=ldata * other)
                #NEWINSTANCE(OBJ=_tmp1724; HEAD=NUMBER; DATA=ldata * other)
                _tmp1724 = cls(NUMBER, ldata * other)
                return _tmp1724
            elif lhead is TERMS:
                #MUL_TERMS_VALUE(VALUE=other; LHS=self; LHSDATA=ldata)
                #MUL_VALUE_TERMS(VALUE=other; RHS=self; RHSDATA=ldata)
                _tmp1745 = other
                if not _tmp1745:
                    return cls.zero
                pairs = ldata
                if len(pairs)==1:
                    t, c = pairs.items()[0]
                    c = _tmp1745 * c
                    if c==1:
                        return t
                    #RETURN_NEW(HEAD=TERMS; DATA={t: c})
                    #NEWINSTANCE(OBJ=_tmp1752; HEAD=TERMS; DATA={t: c})
                    _tmp1752 = cls(TERMS, {t: c})
                    return _tmp1752
                if _tmp1745==1:
                    return self
                pairs = {}
                for t,c in ldata.iteritems():
                    pairs[t] = _tmp1745 * c
                #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA=pairs)
                obj = cls(TERMS, pairs)
                coeff, terms = self._coeff_terms
                if terms is not None:
                    c = coeff * _tmp1745
                    if not c==1:
                        obj._coeff_terms = (c, terms)
                else:
                    obj._coeff_terms = (_tmp1745, self)
                return obj
            elif lhead is FACTORS:
                #MUL_FACTORS_VALUE(VALUE=other; LHS=self; LHSDATA=ldata)
                #MUL_SYMBOL_VALUE(VALUE=other; LHS=self; LHSDATA=ldata)
                #MUL_VALUE_SYMBOL(VALUE=other; RHS=self; RHSDATA=ldata)
                _tmp1787 = other
                if not _tmp1787:
                    return cls.zero
                if _tmp1787==1:
                    return self
                #RETURN_NEW(HEAD=TERMS; DATA={self: _tmp1787})
                #NEWINSTANCE(OBJ=_tmp1794; HEAD=TERMS; DATA={self: _tmp1787})
                _tmp1794 = cls(TERMS, {self: _tmp1787})
                return _tmp1794
            else:
                #MUL_SYMBOL_VALUE(VALUE=other; LHS=self; LHSDATA=ldata)
                #MUL_VALUE_SYMBOL(VALUE=other; RHS=self; RHSDATA=ldata)
                _tmp1815 = other
                if not _tmp1815:
                    return cls.zero
                if _tmp1815==1:
                    return self
                #RETURN_NEW(HEAD=TERMS; DATA={self: _tmp1815})
                #NEWINSTANCE(OBJ=_tmp1822; HEAD=TERMS; DATA={self: _tmp1815})
                _tmp1822 = cls(TERMS, {self: _tmp1815})
                return _tmp1822
        other = cls.convert(other, False)
        if other is NotImplemented:
            return other
    rhead, rdata = other.pair
    if lhead is NUMBER:
        if rhead is NUMBER:
            #MUL_NUMBER_NUMBER(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
            #MUL_VALUE_NUMBER(VALUE=ldata; RHS=other; RHSDATA=rdata)
            #RETURN_NEW(HEAD=NUMBER; DATA=ldata * rdata)
            #NEWINSTANCE(OBJ=_tmp1850; HEAD=NUMBER; DATA=ldata * rdata)
            _tmp1850 = cls(NUMBER, ldata * rdata)
            return _tmp1850
        elif rhead is TERMS:
            #MUL_NUMBER_TERMS(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
            #MUL_VALUE_TERMS(VALUE=ldata; RHS=other; RHSDATA=rdata)
            _tmp1871 = ldata
            if not _tmp1871:
                return cls.zero
            pairs = rdata
            if len(pairs)==1:
                t, c = pairs.items()[0]
                c = _tmp1871 * c
                if c==1:
                    return t
                #RETURN_NEW(HEAD=TERMS; DATA={t: c})
                #NEWINSTANCE(OBJ=_tmp1878; HEAD=TERMS; DATA={t: c})
                _tmp1878 = cls(TERMS, {t: c})
                return _tmp1878
            if _tmp1871==1:
                return other
            pairs = {}
            for t,c in rdata.iteritems():
                pairs[t] = _tmp1871 * c
            #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA=pairs)
            obj = cls(TERMS, pairs)
            coeff, terms = other._coeff_terms
            if terms is not None:
                c = coeff * _tmp1871
                if not c==1:
                    obj._coeff_terms = (c, terms)
            else:
                obj._coeff_terms = (_tmp1871, other)
            return obj
        elif rhead is FACTORS:
            #MUL_NUMBER_FACTORS(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
            #MUL_SYMBOL_VALUE(VALUE=ldata; LHS=other; LHSDATA=rdata)
            #MUL_VALUE_SYMBOL(VALUE=ldata; RHS=other; RHSDATA=rdata)
            _tmp1913 = ldata
            if not _tmp1913:
                return cls.zero
            if _tmp1913==1:
                return other
            #RETURN_NEW(HEAD=TERMS; DATA={other: _tmp1913})
            #NEWINSTANCE(OBJ=_tmp1920; HEAD=TERMS; DATA={other: _tmp1913})
            _tmp1920 = cls(TERMS, {other: _tmp1913})
            return _tmp1920
        else:
            #MUL_NUMBER_SYMBOL(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
            #MUL_VALUE_SYMBOL(VALUE=ldata; RHS=other; RHSDATA=rdata)
            _tmp1941 = ldata
            if not _tmp1941:
                return cls.zero
            if _tmp1941==1:
                return other
            #RETURN_NEW(HEAD=TERMS; DATA={other: _tmp1941})
            #NEWINSTANCE(OBJ=_tmp1948; HEAD=TERMS; DATA={other: _tmp1941})
            _tmp1948 = cls(TERMS, {other: _tmp1941})
            return _tmp1948
    elif lhead is TERMS:
        if rhead is NUMBER:
            #MUL_TERMS_NUMBER(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
            #MUL_TERMS_VALUE(VALUE=rdata; LHS=self; LHSDATA=ldata)
            #MUL_VALUE_TERMS(VALUE=rdata; RHS=self; RHSDATA=ldata)
            _tmp1976 = rdata
            if not _tmp1976:
                return cls.zero
            pairs = ldata
            if len(pairs)==1:
                t, c = pairs.items()[0]
                c = _tmp1976 * c
                if c==1:
                    return t
                #RETURN_NEW(HEAD=TERMS; DATA={t: c})
                #NEWINSTANCE(OBJ=_tmp1983; HEAD=TERMS; DATA={t: c})
                _tmp1983 = cls(TERMS, {t: c})
                return _tmp1983
            if _tmp1976==1:
                return self
            pairs = {}
            for t,c in ldata.iteritems():
                pairs[t] = _tmp1976 * c
            #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA=pairs)
            obj = cls(TERMS, pairs)
            coeff, terms = self._coeff_terms
            if terms is not None:
                c = coeff * _tmp1976
                if not c==1:
                    obj._coeff_terms = (c, terms)
            else:
                obj._coeff_terms = (_tmp1976, self)
            return obj
        elif rhead is TERMS:
            #MUL_TERMS_TERMS(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
            lpairs = ldata
            rpairs = rdata
            if len(lpairs)==1:
                t1,c1 = lpairs.items()[0]
                if len(rpairs)==1:
                    t2,c2 = rpairs.items()[0]
                    t = t1 * t2
                    c = c1 * c2
                    if t == cls.one:
                        return cls.convert(c)
                    if c==1:
                        return t
                    #RETURN_NEW(HEAD=TERMS; DATA={t: c})
                    #NEWINSTANCE(OBJ=_tmp2011; HEAD=TERMS; DATA={t: c})
                    _tmp2011 = cls(TERMS, {t: c})
                    return _tmp2011
                coeff, terms = other._coeff_terms
                if terms is None:
                    return (t1 * other) * c1
                return (t1*terms) * (c1*coeff)
            elif len(rpairs)==1:
                t1,c1 = rpairs.items()[0]
                coeff, terms = other._coeff_terms
                if terms is None:
                    return (t1 * self) * c1
                return (t1*terms) * (c1*coeff)
            lcoeff, lterms = self._coeff_terms
            rcoeff, rterms = other._coeff_terms
            if lterms is None:
                lterms = self
            if rterms is None:
                rterms = other
            if lterms==rterms:
                #NEWINSTANCE(OBJ=_tmp2004; HEAD=FACTORS; DATA={lterms: 2})
                _tmp2004 = cls(FACTORS, {lterms: 2})
            else:
                #NEWINSTANCE(OBJ=_tmp2004; HEAD=FACTORS; DATA={lterms: 1, rterms: 1})
                _tmp2004 = cls(FACTORS, {lterms: 1, rterms: 1})
            c = lcoeff * rcoeff
            if c==1:
                return _tmp2004
            #RETURN_NEW(HEAD=TERMS; DATA={_tmp2004: c})
            #NEWINSTANCE(OBJ=_tmp2039; HEAD=TERMS; DATA={_tmp2004: c})
            _tmp2039 = cls(TERMS, {_tmp2004: c})
            return _tmp2039
        elif rhead is FACTORS:
            #MUL_TERMS_FACTORS(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
            #MUL_FACTORS_TERMS(LHS=other; LHSDATA=rdata; RHS=self; RHSDATA=ldata)
            rpairs = ldata
            if len(rpairs)==1:
                t1,c1 = rpairs.items()[0]
                t = t1 * other
                #RETURN_NEW(HEAD=TERMS; DATA={t: c1})
                #NEWINSTANCE(OBJ=_tmp2067; HEAD=TERMS; DATA={t: c1})
                _tmp2067 = cls(TERMS, {t: c1})
                return _tmp2067
            coeff, terms = self._coeff_terms
            if terms is None:
                #MUL_FACTORS_SYMBOL(LHS=other; LHSDATA=rdata; RHS=self; RHSDATA=ldata)
                pairs = dict(rdata)
                #MUL_DICT_SYMBOL(DICT=pairs; RHS=self; RHSDATA=ldata)
                #ADD_TERM_VALUE_DICT(TERM=self; VALUE=1; DICT=pairs; DICT_GET=pairs.get; SIGN=+; USIGN=)
                _tmp2095 = pairs.get(self)
                if _tmp2095 is None:
                    pairs[self] =  1
                else:
                    _tmp2095 = _tmp2095 + 1
                    if _tmp2095:
                        pairs[self] = _tmp2095
                    else:
                        del pairs[self]
                #CANONIZE_FACTORS_DICT1(DICT=pairs)
                if not pairs:
                    return cls.one
                if len(pairs)==1:
                   t, c = pairs.items()[0]
                   if c==1:
                       return t
                   if t==cls.one:
                       return t
                #RETURN_NEW(HEAD=FACTORS; DATA=pairs)
                #NEWINSTANCE(OBJ=_tmp2109; HEAD=FACTORS; DATA=pairs)
                _tmp2109 = cls(FACTORS, pairs)
                return _tmp2109
            pairs = dict(rdata)
            #ADD_TERM_VALUE_DICT(TERM=terms; VALUE=1; DICT=pairs; DICT_GET=pairs.get; SIGN=+; USIGN=)
            _tmp2123 = pairs.get(terms)
            if _tmp2123 is None:
                pairs[terms] =  1
            else:
                _tmp2123 = _tmp2123 + 1
                if _tmp2123:
                    pairs[terms] = _tmp2123
                else:
                    del pairs[terms]
            #CANONIZE_FACTORS_DICT(DICT=pairs; NUMBER=coeff)
            if not pairs:
                if coeff is 1:
                    return cls.one
                return coeff
            if len(pairs)==1:
               t, c = pairs.items()[0]
               if c==1:
                   if coeff==1:
                       return t
                   #RETURN_NEW(HEAD=TERMS; DATA={t: coeff})
                   #NEWINSTANCE(OBJ=_tmp2137; HEAD=TERMS; DATA={t: coeff})
                   _tmp2137 = cls(TERMS, {t: coeff})
                   return _tmp2137
               if t==cls.one:
                   return coeff
            #NEWINSTANCE(OBJ=_tmp2060; HEAD=FACTORS; DATA=pairs)
            _tmp2060 = cls(FACTORS, pairs)
            #RETURN_NEW(HEAD=TERMS; DATA={_tmp2060: coeff})
            #NEWINSTANCE(OBJ=_tmp2158; HEAD=TERMS; DATA={_tmp2060: coeff})
            _tmp2158 = cls(TERMS, {_tmp2060: coeff})
            return _tmp2158
        else:
            #MUL_TERMS_SYMBOL(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
            pairs = ldata
            if len(pairs)==1:
                t,c = pairs.items()[0]
                t = t * other
                if t==cls.one:
                    return cls.convert(c)
                #RETURN_NEW(HEAD=TERMS; DATA={t: c})
                #NEWINSTANCE(OBJ=_tmp2179; HEAD=TERMS; DATA={t: c})
                _tmp2179 = cls(TERMS, {t: c})
                return _tmp2179
            coeff, terms = self._coeff_terms
            if terms is not None:
                #NEWINSTANCE(OBJ=_tmp2172; HEAD=FACTORS; DATA={terms:1, other:1})
                _tmp2172 = cls(FACTORS, {terms:1, other:1})
                #RETURN_NEW(HEAD=TERMS; DATA={_tmp2172:coeff})
                #NEWINSTANCE(OBJ=_tmp2200; HEAD=TERMS; DATA={_tmp2172:coeff})
                _tmp2200 = cls(TERMS, {_tmp2172:coeff})
                return _tmp2200
            #RETURN_NEW(HEAD=FACTORS; DATA={self: 1, other: 1})
            #NEWINSTANCE(OBJ=_tmp2214; HEAD=FACTORS; DATA={self: 1, other: 1})
            _tmp2214 = cls(FACTORS, {self: 1, other: 1})
            return _tmp2214
    elif lhead is FACTORS:
        if rhead is NUMBER:
            #MUL_FACTORS_NUMBER(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
            #MUL_SYMBOL_VALUE(VALUE=rdata; LHS=self; LHSDATA=ldata)
            #MUL_VALUE_SYMBOL(VALUE=rdata; RHS=self; RHSDATA=ldata)
            _tmp2242 = rdata
            if not _tmp2242:
                return cls.zero
            if _tmp2242==1:
                return self
            #RETURN_NEW(HEAD=TERMS; DATA={self: _tmp2242})
            #NEWINSTANCE(OBJ=_tmp2249; HEAD=TERMS; DATA={self: _tmp2242})
            _tmp2249 = cls(TERMS, {self: _tmp2242})
            return _tmp2249
        elif rhead is TERMS:
            #MUL_FACTORS_TERMS(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
            rpairs = rdata
            if len(rpairs)==1:
                t1,c1 = rpairs.items()[0]
                t = t1 * self
                #RETURN_NEW(HEAD=TERMS; DATA={t: c1})
                #NEWINSTANCE(OBJ=_tmp2270; HEAD=TERMS; DATA={t: c1})
                _tmp2270 = cls(TERMS, {t: c1})
                return _tmp2270
            coeff, terms = other._coeff_terms
            if terms is None:
                #MUL_FACTORS_SYMBOL(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
                pairs = dict(ldata)
                #MUL_DICT_SYMBOL(DICT=pairs; RHS=other; RHSDATA=rdata)
                #ADD_TERM_VALUE_DICT(TERM=other; VALUE=1; DICT=pairs; DICT_GET=pairs.get; SIGN=+; USIGN=)
                _tmp2298 = pairs.get(other)
                if _tmp2298 is None:
                    pairs[other] =  1
                else:
                    _tmp2298 = _tmp2298 + 1
                    if _tmp2298:
                        pairs[other] = _tmp2298
                    else:
                        del pairs[other]
                #CANONIZE_FACTORS_DICT1(DICT=pairs)
                if not pairs:
                    return cls.one
                if len(pairs)==1:
                   t, c = pairs.items()[0]
                   if c==1:
                       return t
                   if t==cls.one:
                       return t
                #RETURN_NEW(HEAD=FACTORS; DATA=pairs)
                #NEWINSTANCE(OBJ=_tmp2312; HEAD=FACTORS; DATA=pairs)
                _tmp2312 = cls(FACTORS, pairs)
                return _tmp2312
            pairs = dict(ldata)
            #ADD_TERM_VALUE_DICT(TERM=terms; VALUE=1; DICT=pairs; DICT_GET=pairs.get; SIGN=+; USIGN=)
            _tmp2326 = pairs.get(terms)
            if _tmp2326 is None:
                pairs[terms] =  1
            else:
                _tmp2326 = _tmp2326 + 1
                if _tmp2326:
                    pairs[terms] = _tmp2326
                else:
                    del pairs[terms]
            #CANONIZE_FACTORS_DICT(DICT=pairs; NUMBER=coeff)
            if not pairs:
                if coeff is 1:
                    return cls.one
                return coeff
            if len(pairs)==1:
               t, c = pairs.items()[0]
               if c==1:
                   if coeff==1:
                       return t
                   #RETURN_NEW(HEAD=TERMS; DATA={t: coeff})
                   #NEWINSTANCE(OBJ=_tmp2340; HEAD=TERMS; DATA={t: coeff})
                   _tmp2340 = cls(TERMS, {t: coeff})
                   return _tmp2340
               if t==cls.one:
                   return coeff
            #NEWINSTANCE(OBJ=_tmp2263; HEAD=FACTORS; DATA=pairs)
            _tmp2263 = cls(FACTORS, pairs)
            #RETURN_NEW(HEAD=TERMS; DATA={_tmp2263: coeff})
            #NEWINSTANCE(OBJ=_tmp2361; HEAD=TERMS; DATA={_tmp2263: coeff})
            _tmp2361 = cls(TERMS, {_tmp2263: coeff})
            return _tmp2361
        elif rhead is FACTORS:
            #MUL_FACTORS_FACTORS(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
            pairs = dict(ldata)
            pairs_get = pairs.get
            number = 1
            for t,c in rdata.iteritems():
                #MUL_FACTOR_VALUE_DICT(FACTOR=t; SIGN=+; USIGN=; VALUE=c; DICT=pairs; DICT_GET=pairs_get; NUMBER=number)
                _tmp2382 = pairs_get(t)
                if _tmp2382 is None:
                    pairs[t] =  c
                else:
                    _tmp2382 = _tmp2382 + c
                    if type(_tmp2382) is cls and _tmp2382.head is NUMBER:
                        _tmp2382 = _tmp2382.data
                    if _tmp2382:
                        if t.head is NUMBER:
                            del pairs[t]
                            z, sym = try_power(t.data, _tmp2382)
                            if sym:
                                for t1, c1 in sym:
                                    #NEWINSTANCE(OBJ=tt; HEAD=NUMBER; DATA=t1)
                                    tt = cls(NUMBER, t1)
                                    #ADD_TERM_VALUE_DICT(DICT=pairs; DICT_GET=pairs_get; TERM=tt; VALUE=c1; SIGN=+; USIGN=)
                                    _tmp2396 = pairs_get(tt)
                                    if _tmp2396 is None:
                                        pairs[tt] =  c1
                                    else:
                                        _tmp2396 = _tmp2396 + c1
                                        if _tmp2396:
                                            pairs[tt] = _tmp2396
                                        else:
                                            del pairs[tt]
                            number = number * z
                        else:
                            pairs[t] = _tmp2382
                    else:
                        del pairs[t]
            #CANONIZE_FACTORS_DICT(DICT=pairs; NUMBER=number)
            if not pairs:
                if number is 1:
                    return cls.one
                return number
            if len(pairs)==1:
               t, c = pairs.items()[0]
               if c==1:
                   if number==1:
                       return t
                   #RETURN_NEW(HEAD=TERMS; DATA={t: number})
                   #NEWINSTANCE(OBJ=_tmp2410; HEAD=TERMS; DATA={t: number})
                   _tmp2410 = cls(TERMS, {t: number})
                   return _tmp2410
               if t==cls.one:
                   return number
            if number == 1:
                #RETURN_NEW(HEAD=FACTORS; DATA=pairs)
                #NEWINSTANCE(OBJ=_tmp2424; HEAD=FACTORS; DATA=pairs)
                _tmp2424 = cls(FACTORS, pairs)
                return _tmp2424
            #NEWINSTANCE(OBJ=obj; HEAD=FACTORS; DATA=pairs)
            obj = cls(FACTORS, pairs)
            #RETURN_NEW(HEAD=TERMS; DATA={obj: number})
            #NEWINSTANCE(OBJ=_tmp2445; HEAD=TERMS; DATA={obj: number})
            _tmp2445 = cls(TERMS, {obj: number})
            return _tmp2445
        else:
            #MUL_FACTORS_SYMBOL(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
            pairs = dict(ldata)
            #MUL_DICT_SYMBOL(DICT=pairs; RHS=other; RHSDATA=rdata)
            #ADD_TERM_VALUE_DICT(TERM=other; VALUE=1; DICT=pairs; DICT_GET=pairs.get; SIGN=+; USIGN=)
            _tmp2473 = pairs.get(other)
            if _tmp2473 is None:
                pairs[other] =  1
            else:
                _tmp2473 = _tmp2473 + 1
                if _tmp2473:
                    pairs[other] = _tmp2473
                else:
                    del pairs[other]
            #CANONIZE_FACTORS_DICT1(DICT=pairs)
            if not pairs:
                return cls.one
            if len(pairs)==1:
               t, c = pairs.items()[0]
               if c==1:
                   return t
               if t==cls.one:
                   return t
            #RETURN_NEW(HEAD=FACTORS; DATA=pairs)
            #NEWINSTANCE(OBJ=_tmp2487; HEAD=FACTORS; DATA=pairs)
            _tmp2487 = cls(FACTORS, pairs)
            return _tmp2487
    else:
        if rhead is NUMBER:
            #MUL_SYMBOL_NUMBER(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
            #MUL_SYMBOL_VALUE(VALUE=rdata; LHS=self; LHSDATA=ldata)
            #MUL_VALUE_SYMBOL(VALUE=rdata; RHS=self; RHSDATA=ldata)
            _tmp2515 = rdata
            if not _tmp2515:
                return cls.zero
            if _tmp2515==1:
                return self
            #RETURN_NEW(HEAD=TERMS; DATA={self: _tmp2515})
            #NEWINSTANCE(OBJ=_tmp2522; HEAD=TERMS; DATA={self: _tmp2515})
            _tmp2522 = cls(TERMS, {self: _tmp2515})
            return _tmp2522
        elif rhead is TERMS:
            #MUL_SYMBOL_TERMS(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
            #MUL_TERMS_SYMBOL(LHS=other; LHSDATA=rdata; RHS=self; RHSDATA=ldata)
            pairs = rdata
            if len(pairs)==1:
                t,c = pairs.items()[0]
                t = t * self
                if t==cls.one:
                    return cls.convert(c)
                #RETURN_NEW(HEAD=TERMS; DATA={t: c})
                #NEWINSTANCE(OBJ=_tmp2550; HEAD=TERMS; DATA={t: c})
                _tmp2550 = cls(TERMS, {t: c})
                return _tmp2550
            coeff, terms = other._coeff_terms
            if terms is not None:
                #NEWINSTANCE(OBJ=_tmp2543; HEAD=FACTORS; DATA={terms:1, self:1})
                _tmp2543 = cls(FACTORS, {terms:1, self:1})
                #RETURN_NEW(HEAD=TERMS; DATA={_tmp2543:coeff})
                #NEWINSTANCE(OBJ=_tmp2571; HEAD=TERMS; DATA={_tmp2543:coeff})
                _tmp2571 = cls(TERMS, {_tmp2543:coeff})
                return _tmp2571
            #RETURN_NEW(HEAD=FACTORS; DATA={other: 1, self: 1})
            #NEWINSTANCE(OBJ=_tmp2585; HEAD=FACTORS; DATA={other: 1, self: 1})
            _tmp2585 = cls(FACTORS, {other: 1, self: 1})
            return _tmp2585
        elif rhead is FACTORS:
            #MUL_SYMBOL_FACTORS(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
            #MUL_FACTORS_SYMBOL(LHS=other; LHSDATA=rdata; RHS=self; RHSDATA=ldata)
            pairs = dict(rdata)
            #MUL_DICT_SYMBOL(DICT=pairs; RHS=self; RHSDATA=ldata)
            #ADD_TERM_VALUE_DICT(TERM=self; VALUE=1; DICT=pairs; DICT_GET=pairs.get; SIGN=+; USIGN=)
            _tmp2620 = pairs.get(self)
            if _tmp2620 is None:
                pairs[self] =  1
            else:
                _tmp2620 = _tmp2620 + 1
                if _tmp2620:
                    pairs[self] = _tmp2620
                else:
                    del pairs[self]
            #CANONIZE_FACTORS_DICT1(DICT=pairs)
            if not pairs:
                return cls.one
            if len(pairs)==1:
               t, c = pairs.items()[0]
               if c==1:
                   return t
               if t==cls.one:
                   return t
            #RETURN_NEW(HEAD=FACTORS; DATA=pairs)
            #NEWINSTANCE(OBJ=_tmp2634; HEAD=FACTORS; DATA=pairs)
            _tmp2634 = cls(FACTORS, pairs)
            return _tmp2634
        else:
            #MUL_SYMBOL_SYMBOL(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
            if self == other:
                pairs = {self: 2}
            else:
                pairs = {self: 1, other: 1}
            #RETURN_NEW(HEAD=FACTORS; DATA=pairs)
            #NEWINSTANCE(OBJ=_tmp2655; HEAD=FACTORS; DATA=pairs)
            _tmp2655 = cls(FACTORS, pairs)
            return _tmp2655

def div_method(self, other, NUMBER=NUMBER, TERMS=TERMS, FACTORS=FACTORS):
    cls = type(self)
    lhead, ldata = self.pair
    if type(other) is not cls:
        if isinstance(other, cls.coefftypes):
            if lhead is NUMBER:
                #DIV_NUMBER_VALUE(VALUE=other; LHS=self; LHSDATA=ldata)
                #RETURN_NEW2(HEAD=NUMBER; DATA=div(self.data, other, cls))
                _tmp2676 = div(self.data, other, cls)
                if isinstance(_tmp2676, Infinity):
                    return _tmp2676
                #RETURN_NEW(HEAD=NUMBER; DATA=_tmp2676)
                #NEWINSTANCE(OBJ=_tmp2683; HEAD=NUMBER; DATA=_tmp2676)
                _tmp2683 = cls(NUMBER, _tmp2676)
                return _tmp2683
            elif lhead is TERMS:
                #DIV_TERMS_VALUE(VALUE=other; LHS=self; LHSDATA=ldata)
                #MUL_TERMS_VALUE(LHS=self; LHSDATA=ldata; VALUE=div(1,other,cls))
                #MUL_VALUE_TERMS(VALUE=div(1,other,cls); RHS=self; RHSDATA=ldata)
                _tmp2711 = div(1,other,cls)
                if not _tmp2711:
                    return cls.zero
                pairs = ldata
                if len(pairs)==1:
                    t, c = pairs.items()[0]
                    c = _tmp2711 * c
                    if c==1:
                        return t
                    #RETURN_NEW(HEAD=TERMS; DATA={t: c})
                    #NEWINSTANCE(OBJ=_tmp2718; HEAD=TERMS; DATA={t: c})
                    _tmp2718 = cls(TERMS, {t: c})
                    return _tmp2718
                if _tmp2711==1:
                    return self
                pairs = {}
                for t,c in ldata.iteritems():
                    pairs[t] = _tmp2711 * c
                #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA=pairs)
                obj = cls(TERMS, pairs)
                coeff, terms = self._coeff_terms
                if terms is not None:
                    c = coeff * _tmp2711
                    if not c==1:
                        obj._coeff_terms = (c, terms)
                else:
                    obj._coeff_terms = (_tmp2711, self)
                return obj
            elif lhead is FACTORS:
                #DIV_FACTORS_VALUE(VALUE=other; LHS=self; LHSDATA=ldata)
                #MUL_FACTORS_VALUE(LHS=self; LHSDATA=ldata; VALUE=div(1,other,cls))
                #MUL_SYMBOL_VALUE(VALUE=div(1,other,cls); LHS=self; LHSDATA=ldata)
                #MUL_VALUE_SYMBOL(VALUE=div(1,other,cls); RHS=self; RHSDATA=ldata)
                _tmp2760 = div(1,other,cls)
                if not _tmp2760:
                    return cls.zero
                if _tmp2760==1:
                    return self
                #RETURN_NEW(HEAD=TERMS; DATA={self: _tmp2760})
                #NEWINSTANCE(OBJ=_tmp2767; HEAD=TERMS; DATA={self: _tmp2760})
                _tmp2767 = cls(TERMS, {self: _tmp2760})
                return _tmp2767
            else:
                #DIV_SYMBOL_VALUE(VALUE=other; LHS=self; LHSDATA=ldata)
                #MUL_VALUE_SYMBOL(VALUE=div(1, other, cls); RHS=self; RHSDATA=ldata)
                _tmp2788 = div(1, other, cls)
                if not _tmp2788:
                    return cls.zero
                if _tmp2788==1:
                    return self
                #RETURN_NEW(HEAD=TERMS; DATA={self: _tmp2788})
                #NEWINSTANCE(OBJ=_tmp2795; HEAD=TERMS; DATA={self: _tmp2788})
                _tmp2795 = cls(TERMS, {self: _tmp2788})
                return _tmp2795
        other = cls.convert(other, False)
        if other is NotImplemented:
            return other
    rhead, rdata = other.pair
    if lhead is NUMBER:
        if rhead is NUMBER:
            #DIV_NUMBER_NUMBER(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
            #DIV_VALUE_NUMBER(VALUE=self.data; RHS=other)
            #RETURN_NEW2(HEAD=NUMBER; DATA=div(self.data, other.data, cls))
            _tmp2823 = div(self.data, other.data, cls)
            if isinstance(_tmp2823, Infinity):
                return _tmp2823
            #RETURN_NEW(HEAD=NUMBER; DATA=_tmp2823)
            #NEWINSTANCE(OBJ=_tmp2830; HEAD=NUMBER; DATA=_tmp2823)
            _tmp2830 = cls(NUMBER, _tmp2823)
            return _tmp2830
        elif rhead is TERMS:
            #DIV_NUMBER_TERMS(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
            #DIV_VALUE_TERMS(VALUE=ldata; RHS=other; RHSDATA=rdata)
            _tmp2851 = ldata
            if not _tmp2851:
                return cls.zero
            pairs = other.data
            if len(pairs)==1:
                t, c = pairs.items()[0]
                c = div(ldata, c, cls)
                t = 1/t
                if c==1:
                    return t
                if t==cls.one:
                    return cls.convert(c)
                #RETURN_NEW(HEAD=TERMS; DATA={t: c})
                #NEWINSTANCE(OBJ=_tmp2858; HEAD=TERMS; DATA={t: c})
                _tmp2858 = cls(TERMS, {t: c})
                return _tmp2858
            #NEWINSTANCE(OBJ=_tmp2851; HEAD=FACTORS; DATA={other: -1})
            _tmp2851 = cls(FACTORS, {other: -1})
            if ldata==1:
                return _tmp2851
            #RETURN_NEW(HEAD=TERMS; DATA={_tmp2851: ldata})
            #NEWINSTANCE(OBJ=_tmp2879; HEAD=TERMS; DATA={_tmp2851: ldata})
            _tmp2879 = cls(TERMS, {_tmp2851: ldata})
            return _tmp2879
        elif rhead is FACTORS:
            #DIV_NUMBER_FACTORS(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
            #DIV_VALUE_FACTORS(VALUE=ldata; RHS=other; RHSDATA=rdata)
            
            pairs = rdata
            if len(pairs)==1:
                t, c = pairs.items()[0]
                c = -c
                if c==1:
                    return t * ldata
                new_pairs = {t: c}
            else:
                #NEG_DICT_VALUES(DICT_IN=pairs; DICT_OUT=new_pairs)
                new_pairs = dict([(t, -c) for t,c in pairs.iteritems()])
            #NEWINSTANCE(OBJ=_tmp2900; HEAD=FACTORS; DATA=new_pairs)
            _tmp2900 = cls(FACTORS, new_pairs)
            if ldata==1:
                return _tmp2900
            #RETURN_NEW(HEAD=TERMS; DATA={_tmp2900: ldata})
            #NEWINSTANCE(OBJ=_tmp2921; HEAD=TERMS; DATA={_tmp2900: ldata})
            _tmp2921 = cls(TERMS, {_tmp2900: ldata})
            return _tmp2921
        else:
            #DIV_NUMBER_SYMBOL(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
            #DIV_VALUE_SYMBOL(VALUE=ldata; RHS=other; RHSDATA=rdata)
            _tmp2942 = ldata
            if not _tmp2942:
                return cls.zero
            #NEWINSTANCE(OBJ=obj2; HEAD=FACTORS; DATA={other: -1})
            obj2 = cls(FACTORS, {other: -1})
            if _tmp2942==1:
                return obj2
            #RETURN_NEW(HEAD=TERMS; DATA={obj2: _tmp2942})
            #NEWINSTANCE(OBJ=_tmp2956; HEAD=TERMS; DATA={obj2: _tmp2942})
            _tmp2956 = cls(TERMS, {obj2: _tmp2942})
            return _tmp2956
    elif lhead is TERMS:
        if rhead is NUMBER:
            #DIV_TERMS_NUMBER(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
            #DIV_TERMS_VALUE(VALUE=rdata; LHS=self; LHSDATA=ldata)
            #MUL_TERMS_VALUE(LHS=self; LHSDATA=ldata; VALUE=div(1,rdata,cls))
            #MUL_VALUE_TERMS(VALUE=div(1,rdata,cls); RHS=self; RHSDATA=ldata)
            _tmp2991 = div(1,rdata,cls)
            if not _tmp2991:
                return cls.zero
            pairs = ldata
            if len(pairs)==1:
                t, c = pairs.items()[0]
                c = _tmp2991 * c
                if c==1:
                    return t
                #RETURN_NEW(HEAD=TERMS; DATA={t: c})
                #NEWINSTANCE(OBJ=_tmp2998; HEAD=TERMS; DATA={t: c})
                _tmp2998 = cls(TERMS, {t: c})
                return _tmp2998
            if _tmp2991==1:
                return self
            pairs = {}
            for t,c in ldata.iteritems():
                pairs[t] = _tmp2991 * c
            #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA=pairs)
            obj = cls(TERMS, pairs)
            coeff, terms = self._coeff_terms
            if terms is not None:
                c = coeff * _tmp2991
                if not c==1:
                    obj._coeff_terms = (c, terms)
            else:
                obj._coeff_terms = (_tmp2991, self)
            return obj
        elif rhead is TERMS:
            #DIV_TERMS_TERMS(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
            
            if self==other:
                return cls.one
            lpairs = ldata
            rpairs = rdata
            if len(lpairs)==1:
                t1, c1 = lpairs.items()[0]
                if len(rpairs)==1:
                    t2, c2 = rpairs.items()[0]
                    c = div(c1, c2, cls)
                    if t2==t1:
                        return cls.convert(c)
                    if c==1:
                        #RETURN_NEW(HEAD=FACTORS; DATA={t1:1, t2:-1})
                        #NEWINSTANCE(OBJ=_tmp3026; HEAD=FACTORS; DATA={t1:1, t2:-1})
                        _tmp3026 = cls(FACTORS, {t1:1, t2:-1})
                        return _tmp3026
                    #NEWINSTANCE(OBJ=_tmp3019; HEAD=FACTORS; DATA={t1:1, t2:-1})
                    _tmp3019 = cls(FACTORS, {t1:1, t2:-1})
                else:
                    #NEWINSTANCE(OBJ=_tmp3019; HEAD=FACTORS; DATA={t1:1, other:-1})
                    _tmp3019 = cls(FACTORS, {t1:1, other:-1})
                #RETURN_NEW(HEAD=TERMS; DATA={_tmp3019:c1})
                #NEWINSTANCE(OBJ=_tmp3054; HEAD=TERMS; DATA={_tmp3019:c1})
                _tmp3054 = cls(TERMS, {_tmp3019:c1})
                return _tmp3054
            elif len(rpairs)==1:
                t2, c2 = rpairs.items()[0]
                c = div(1, c2, cls)
                if t2==self:
                    return cls.convert(c)
                _tmp3019 = self / t2
                #RETURN_NEW(HEAD=TERMS; DATA={_tmp3019:c})
                #NEWINSTANCE(OBJ=_tmp3068; HEAD=TERMS; DATA={_tmp3019:c})
                _tmp3068 = cls(TERMS, {_tmp3019:c})
                return _tmp3068
            #RETURN_NEW(HEAD=FACTORS; DATA={self:1, other:-1})
            #NEWINSTANCE(OBJ=_tmp3082; HEAD=FACTORS; DATA={self:1, other:-1})
            _tmp3082 = cls(FACTORS, {self:1, other:-1})
            return _tmp3082
        elif rhead is FACTORS:
            #DIV_TERMS_FACTORS(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
            lpairs = ldata
            if len(lpairs)==1:
                t, c = lpairs.items()[0]
                t = t / other
                if t==cls.one:
                    return cls.convert(c)
                head, data = t.pair
                if head is NUMBER:
                    #RETURN_NEW(HEAD=NUMBER; DATA=data * c)
                    #NEWINSTANCE(OBJ=_tmp3103; HEAD=NUMBER; DATA=data * c)
                    _tmp3103 = cls(NUMBER, data * c)
                    return _tmp3103
                elif head is TERMS:
                    #MUL_TERMS_VALUE(LHS=t; LHSDATA=data; VALUE=c)
                    #MUL_VALUE_TERMS(VALUE=c; RHS=t; RHSDATA=data)
                    _tmp3124 = c
                    if not _tmp3124:
                        return cls.zero
                    pairs = data
                    if len(pairs)==1:
                        t, c = pairs.items()[0]
                        c = _tmp3124 * c
                        if c==1:
                            return t
                        #RETURN_NEW(HEAD=TERMS; DATA={t: c})
                        #NEWINSTANCE(OBJ=_tmp3131; HEAD=TERMS; DATA={t: c})
                        _tmp3131 = cls(TERMS, {t: c})
                        return _tmp3131
                    if _tmp3124==1:
                        return t
                    pairs = {}
                    for t,c in data.iteritems():
                        pairs[t] = _tmp3124 * c
                    #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA=pairs)
                    obj = cls(TERMS, pairs)
                    coeff, terms = t._coeff_terms
                    if terms is not None:
                        c = coeff * _tmp3124
                        if not c==1:
                            obj._coeff_terms = (c, terms)
                    else:
                        obj._coeff_terms = (_tmp3124, t)
                    return obj
                else:
                    #MUL_SYMBOL_VALUE(LHS=t; LHSDATA=data; VALUE=c)
                    #MUL_VALUE_SYMBOL(VALUE=c; RHS=t; RHSDATA=data)
                    _tmp3159 = c
                    if not _tmp3159:
                        return cls.zero
                    if _tmp3159==1:
                        return t
                    #RETURN_NEW(HEAD=TERMS; DATA={t: _tmp3159})
                    #NEWINSTANCE(OBJ=_tmp3166; HEAD=TERMS; DATA={t: _tmp3159})
                    _tmp3166 = cls(TERMS, {t: _tmp3159})
                    return _tmp3166
            #DIV_SYMBOL_FACTORS(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
            pairs = rdata
            if len(pairs)==1:
                t, c = pairs.items()[0]
                if t==self:
                    c = 1 - c
                    if not c:
                        return cls.one
                    if c==1:
                        return t
                    else:
                        #RETURN_NEW(HEAD=FACTORS; DATA={t: c})
                        #NEWINSTANCE(OBJ=_tmp3187; HEAD=FACTORS; DATA={t: c})
                        _tmp3187 = cls(FACTORS, {t: c})
                        return _tmp3187
                #RETURN_NEW(HEAD=FACTORS; DATA={t: -c, self: 1})
                #NEWINSTANCE(OBJ=_tmp3201; HEAD=FACTORS; DATA={t: -c, self: 1})
                _tmp3201 = cls(FACTORS, {t: -c, self: 1})
                return _tmp3201
            #NEG_DICT_VALUES(DICT_IN=rdata; DICT_OUT=pairs)
            pairs = dict([(t, -c) for t,c in rdata.iteritems()])
            #MUL_DICT_SYMBOL(DICT=pairs; RHS=self; RHSDATA=ldata)
            #ADD_TERM_VALUE_DICT(TERM=self; VALUE=1; DICT=pairs; DICT_GET=pairs.get; SIGN=+; USIGN=)
            _tmp3229 = pairs.get(self)
            if _tmp3229 is None:
                pairs[self] =  1
            else:
                _tmp3229 = _tmp3229 + 1
                if _tmp3229:
                    pairs[self] = _tmp3229
                else:
                    del pairs[self]
            #CANONIZE_FACTORS_DICT1(DICT=pairs)
            if not pairs:
                return cls.one
            if len(pairs)==1:
               t, c = pairs.items()[0]
               if c==1:
                   return t
               if t==cls.one:
                   return t
            #RETURN_NEW(HEAD=FACTORS; DATA=pairs)
            #NEWINSTANCE(OBJ=_tmp3243; HEAD=FACTORS; DATA=pairs)
            _tmp3243 = cls(FACTORS, pairs)
            return _tmp3243
        else:
            #DIV_TERMS_SYMBOL(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
            
            pairs = ldata
            if len(pairs)==1:
                t, c = pairs.items()[0]
                if t==other:
                    return cls.convert(c)
                return (t / other) * c
            #RETURN_NEW(HEAD=FACTORS; DATA={self: 1, other: -1})
            #NEWINSTANCE(OBJ=_tmp3264; HEAD=FACTORS; DATA={self: 1, other: -1})
            _tmp3264 = cls(FACTORS, {self: 1, other: -1})
            return _tmp3264
    elif lhead is FACTORS:
        if rhead is NUMBER:
            #DIV_FACTORS_NUMBER(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
            #DIV_FACTORS_VALUE(VALUE=rdata; LHS=self; LHSDATA=ldata)
            #MUL_FACTORS_VALUE(LHS=self; LHSDATA=ldata; VALUE=div(1,rdata,cls))
            #MUL_SYMBOL_VALUE(VALUE=div(1,rdata,cls); LHS=self; LHSDATA=ldata)
            #MUL_VALUE_SYMBOL(VALUE=div(1,rdata,cls); RHS=self; RHSDATA=ldata)
            _tmp3306 = div(1,rdata,cls)
            if not _tmp3306:
                return cls.zero
            if _tmp3306==1:
                return self
            #RETURN_NEW(HEAD=TERMS; DATA={self: _tmp3306})
            #NEWINSTANCE(OBJ=_tmp3313; HEAD=TERMS; DATA={self: _tmp3306})
            _tmp3313 = cls(TERMS, {self: _tmp3306})
            return _tmp3313
        elif rhead is TERMS:
            #DIV_FACTORS_TERMS(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
            rpairs = rdata
            if len(rpairs)==1:
                t, c = rpairs.items()[0]
                t = self / t
                c = div(1, c, cls)
                if t==cls.one:
                    return cls.convert(c)
                head, data = t.pair
                if head is NUMBER:
                    #RETURN_NEW(HEAD=NUMBER; DATA=data * c)
                    #NEWINSTANCE(OBJ=_tmp3334; HEAD=NUMBER; DATA=data * c)
                    _tmp3334 = cls(NUMBER, data * c)
                    return _tmp3334
                elif head is TERMS:
                    #MUL_TERMS_VALUE(LHS=t; LHSDATA=data; VALUE=c)
                    #MUL_VALUE_TERMS(VALUE=c; RHS=t; RHSDATA=data)
                    _tmp3355 = c
                    if not _tmp3355:
                        return cls.zero
                    pairs = data
                    if len(pairs)==1:
                        t, c = pairs.items()[0]
                        c = _tmp3355 * c
                        if c==1:
                            return t
                        #RETURN_NEW(HEAD=TERMS; DATA={t: c})
                        #NEWINSTANCE(OBJ=_tmp3362; HEAD=TERMS; DATA={t: c})
                        _tmp3362 = cls(TERMS, {t: c})
                        return _tmp3362
                    if _tmp3355==1:
                        return t
                    pairs = {}
                    for t,c in data.iteritems():
                        pairs[t] = _tmp3355 * c
                    #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA=pairs)
                    obj = cls(TERMS, pairs)
                    coeff, terms = t._coeff_terms
                    if terms is not None:
                        c = coeff * _tmp3355
                        if not c==1:
                            obj._coeff_terms = (c, terms)
                    else:
                        obj._coeff_terms = (_tmp3355, t)
                    return obj
                else:
                    #MUL_SYMBOL_VALUE(LHS=t; LHSDATA=data; VALUE=c)
                    #MUL_VALUE_SYMBOL(VALUE=c; RHS=t; RHSDATA=data)
                    _tmp3390 = c
                    if not _tmp3390:
                        return cls.zero
                    if _tmp3390==1:
                        return t
                    #RETURN_NEW(HEAD=TERMS; DATA={t: _tmp3390})
                    #NEWINSTANCE(OBJ=_tmp3397; HEAD=TERMS; DATA={t: _tmp3390})
                    _tmp3397 = cls(TERMS, {t: _tmp3390})
                    return _tmp3397
            #DIV_FACTORS_SYMBOL(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
            pairs = dict(ldata)
            #DIV_DICT_SYMBOL(RHS=other; RHSDATA=rdata; DICT=pairs)
            #ADD_TERM_VALUE_DICT(TERM=other; VALUE=-1; DICT=pairs; DICT_GET=pairs.get; SIGN=+; USIGN=)
            _tmp3425 = pairs.get(other)
            if _tmp3425 is None:
                pairs[other] =  -1
            else:
                _tmp3425 = _tmp3425 + -1
                if _tmp3425:
                    pairs[other] = _tmp3425
                else:
                    del pairs[other]
            #CANONIZE_FACTORS_DICT1(DICT=pairs)
            if not pairs:
                return cls.one
            if len(pairs)==1:
               t, c = pairs.items()[0]
               if c==1:
                   return t
               if t==cls.one:
                   return t
            #RETURN_NEW(HEAD=FACTORS; DATA=pairs)
            #NEWINSTANCE(OBJ=_tmp3439; HEAD=FACTORS; DATA=pairs)
            _tmp3439 = cls(FACTORS, pairs)
            return _tmp3439
        elif rhead is FACTORS:
            #DIV_FACTORS_FACTORS(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
            pairs = dict(ldata)
            pairs_get = pairs.get
            number = 1
            for t,c in rdata.iteritems():
                #MUL_FACTOR_VALUE_DICT(FACTOR=t; SIGN=-; USIGN=-; VALUE=c; DICT=pairs; DICT_GET=pairs_get; NUMBER=number)
                _tmp3460 = pairs_get(t)
                if _tmp3460 is None:
                    pairs[t] = - c
                else:
                    _tmp3460 = _tmp3460 - c
                    if type(_tmp3460) is cls and _tmp3460.head is NUMBER:
                        _tmp3460 = _tmp3460.data
                    if _tmp3460:
                        if t.head is NUMBER:
                            del pairs[t]
                            z, sym = try_power(t.data, _tmp3460)
                            if sym:
                                for t1, c1 in sym:
                                    #NEWINSTANCE(OBJ=tt; HEAD=NUMBER; DATA=t1)
                                    tt = cls(NUMBER, t1)
                                    #ADD_TERM_VALUE_DICT(DICT=pairs; DICT_GET=pairs_get; TERM=tt; VALUE=c1; SIGN=+; USIGN=)
                                    _tmp3474 = pairs_get(tt)
                                    if _tmp3474 is None:
                                        pairs[tt] =  c1
                                    else:
                                        _tmp3474 = _tmp3474 + c1
                                        if _tmp3474:
                                            pairs[tt] = _tmp3474
                                        else:
                                            del pairs[tt]
                            number = number * z
                        else:
                            pairs[t] = _tmp3460
                    else:
                        del pairs[t]
            #CANONIZE_FACTORS_DICT(DICT=pairs; NUMBER=number)
            if not pairs:
                if number is 1:
                    return cls.one
                return number
            if len(pairs)==1:
               t, c = pairs.items()[0]
               if c==1:
                   if number==1:
                       return t
                   #RETURN_NEW(HEAD=TERMS; DATA={t: number})
                   #NEWINSTANCE(OBJ=_tmp3488; HEAD=TERMS; DATA={t: number})
                   _tmp3488 = cls(TERMS, {t: number})
                   return _tmp3488
               if t==cls.one:
                   return number
            if number==1:
                #RETURN_NEW(HEAD=FACTORS; DATA=pairs)
                #NEWINSTANCE(OBJ=_tmp3502; HEAD=FACTORS; DATA=pairs)
                _tmp3502 = cls(FACTORS, pairs)
                return _tmp3502
            #NEWINSTANCE(OBJ=_tmp3453; HEAD=FACTORS; DATA=pairs)
            _tmp3453 = cls(FACTORS, pairs)
            #RETURN_NEW(HEAD=TERMS; DATA={_tmp3453: number})
            #NEWINSTANCE(OBJ=_tmp3523; HEAD=TERMS; DATA={_tmp3453: number})
            _tmp3523 = cls(TERMS, {_tmp3453: number})
            return _tmp3523
        else:
            #DIV_FACTORS_SYMBOL(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
            pairs = dict(ldata)
            #DIV_DICT_SYMBOL(RHS=other; RHSDATA=rdata; DICT=pairs)
            #ADD_TERM_VALUE_DICT(TERM=other; VALUE=-1; DICT=pairs; DICT_GET=pairs.get; SIGN=+; USIGN=)
            _tmp3551 = pairs.get(other)
            if _tmp3551 is None:
                pairs[other] =  -1
            else:
                _tmp3551 = _tmp3551 + -1
                if _tmp3551:
                    pairs[other] = _tmp3551
                else:
                    del pairs[other]
            #CANONIZE_FACTORS_DICT1(DICT=pairs)
            if not pairs:
                return cls.one
            if len(pairs)==1:
               t, c = pairs.items()[0]
               if c==1:
                   return t
               if t==cls.one:
                   return t
            #RETURN_NEW(HEAD=FACTORS; DATA=pairs)
            #NEWINSTANCE(OBJ=_tmp3565; HEAD=FACTORS; DATA=pairs)
            _tmp3565 = cls(FACTORS, pairs)
            return _tmp3565
    else:
        if rhead is NUMBER:
            #DIV_SYMBOL_NUMBER(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
            #DIV_SYMBOL_VALUE(VALUE=rdata; LHS=self; LHSDATA=ldata)
            #MUL_VALUE_SYMBOL(VALUE=div(1, rdata, cls); RHS=self; RHSDATA=ldata)
            _tmp3593 = div(1, rdata, cls)
            if not _tmp3593:
                return cls.zero
            if _tmp3593==1:
                return self
            #RETURN_NEW(HEAD=TERMS; DATA={self: _tmp3593})
            #NEWINSTANCE(OBJ=_tmp3600; HEAD=TERMS; DATA={self: _tmp3593})
            _tmp3600 = cls(TERMS, {self: _tmp3593})
            return _tmp3600
        elif rhead is TERMS:
            #DIV_SYMBOL_TERMS(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
            pairs = rdata
            if len(pairs)==1:
                t,c = pairs.items()[0]
                if self==t:
                    return cls.convert(div(1, c, cls))
                #NEWINSTANCE(OBJ=_tmp3614; HEAD=FACTORS; DATA={self:1, t:-1})
                _tmp3614 = cls(FACTORS, {self:1, t:-1})
                #RETURN_NEW(HEAD=TERMS; DATA={_tmp3614: div(1, c, cls)})
                #NEWINSTANCE(OBJ=_tmp3628; HEAD=TERMS; DATA={_tmp3614: div(1, c, cls)})
                _tmp3628 = cls(TERMS, {_tmp3614: div(1, c, cls)})
                return _tmp3628
            #RETURN_NEW(HEAD=FACTORS; DATA={self:1, other:-1})
            #NEWINSTANCE(OBJ=_tmp3642; HEAD=FACTORS; DATA={self:1, other:-1})
            _tmp3642 = cls(FACTORS, {self:1, other:-1})
            return _tmp3642
        elif rhead is FACTORS:
            #DIV_SYMBOL_FACTORS(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
            pairs = rdata
            if len(pairs)==1:
                t, c = pairs.items()[0]
                if t==self:
                    c = 1 - c
                    if not c:
                        return cls.one
                    if c==1:
                        return t
                    else:
                        #RETURN_NEW(HEAD=FACTORS; DATA={t: c})
                        #NEWINSTANCE(OBJ=_tmp3663; HEAD=FACTORS; DATA={t: c})
                        _tmp3663 = cls(FACTORS, {t: c})
                        return _tmp3663
                #RETURN_NEW(HEAD=FACTORS; DATA={t: -c, self: 1})
                #NEWINSTANCE(OBJ=_tmp3677; HEAD=FACTORS; DATA={t: -c, self: 1})
                _tmp3677 = cls(FACTORS, {t: -c, self: 1})
                return _tmp3677
            #NEG_DICT_VALUES(DICT_IN=rdata; DICT_OUT=pairs)
            pairs = dict([(t, -c) for t,c in rdata.iteritems()])
            #MUL_DICT_SYMBOL(DICT=pairs; RHS=self; RHSDATA=ldata)
            #ADD_TERM_VALUE_DICT(TERM=self; VALUE=1; DICT=pairs; DICT_GET=pairs.get; SIGN=+; USIGN=)
            _tmp3705 = pairs.get(self)
            if _tmp3705 is None:
                pairs[self] =  1
            else:
                _tmp3705 = _tmp3705 + 1
                if _tmp3705:
                    pairs[self] = _tmp3705
                else:
                    del pairs[self]
            #CANONIZE_FACTORS_DICT1(DICT=pairs)
            if not pairs:
                return cls.one
            if len(pairs)==1:
               t, c = pairs.items()[0]
               if c==1:
                   return t
               if t==cls.one:
                   return t
            #RETURN_NEW(HEAD=FACTORS; DATA=pairs)
            #NEWINSTANCE(OBJ=_tmp3719; HEAD=FACTORS; DATA=pairs)
            _tmp3719 = cls(FACTORS, pairs)
            return _tmp3719
        else:
            #DIV_SYMBOL_SYMBOL(LHS=self; LHSDATA=ldata; RHS=other; RHSDATA=rdata)
            if self == other:
                return cls.one
            #RETURN_NEW(HEAD=FACTORS; DATA={self: 1, other: -1})
            #NEWINSTANCE(OBJ=_tmp3740; HEAD=FACTORS; DATA={self: 1, other: -1})
            _tmp3740 = cls(FACTORS, {self: 1, other: -1})
            return _tmp3740
