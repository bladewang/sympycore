"""
This file is generated by the sympycore/basealgebra/mk_pairs.py script.
DO NOT CHANGE THIS FILE DIRECTLY!!!
"""

from ..utils import NUMBER, SYMBOL, TERMS, FACTORS, RedirectOperation
from ..arithmetic.numbers import ExtendedNumber, normalized_fraction, FractionTuple

def div(a, b, inttypes = (int, long)):
    if isinstance(b, inttypes):
        if isinstance(a, inttypes):
            if not b:
                if not a:
                    return ExtendedNumber.get_undefined()
                return ExtendedNumber.get_zoo()
            return normalized_fraction(a, b)
        if not b:
            if isinstance(a, ExtendedNumber):
                return a / b
            return ExtendedNumber.get_zoo()
        if b == 1:
            return a
        return FractionTuple((1,b)) * a
    return a / b




def neg_method(self, NUMBER=NUMBER, TERMS=TERMS, new=object.__new__):
    cls = self.__class__
    lhead = self.head
    if lhead is NUMBER:
        #NEG_NUMBER(OP=self)
        #RETURN_NEW(HEAD=NUMBER; DATA=-self.data)
        #NEWINSTANCE(OBJ=obj; HEAD=NUMBER; DATA=-self.data)
        obj = new(cls)
        obj.head = NUMBER
        obj.data = -self.data
        return obj
    elif lhead is TERMS:
        #NEG_TERMS(OP=self)
        op_pairs = self.data
        if len(op_pairs)==1:
            t, c = op_pairs.items()[0]
            c = -c
            if c==1:
                return t
            #RETURN_NEW(HEAD=TERMS; DATA={t:c})
            #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={t:c})
            obj = new(cls)
            obj.head = TERMS
            obj.data = {t:c}
            return obj
        #NEG_DICT_VALUES(DICT_IN=self.data; DICT_OUT=pairs)
        pairs = dict([(t, -c) for t,c in self.data.iteritems()])
        #RETURN_NEW(HEAD=TERMS; DATA=pairs)
        #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA=pairs)
        obj = new(cls)
        obj.head = TERMS
        obj.data = pairs
        return obj
    else:
        #NEG_SYMBOL(OP=self)
        #RETURN_NEW(HEAD=TERMS; DATA={self: -1})
        #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={self: -1})
        obj = new(cls)
        obj.head = TERMS
        obj.data = {self: -1}
        return obj

def rsub_method(self, other, NUMBER=NUMBER, TERMS=TERMS, FACTORS=FACTORS, new=object.__new__):
    cls = self.__class__
    lhead = self.head
    if isinstance(other, cls.coefftypes):
        if lhead is NUMBER:
            #SUB_VALUE_NUMBER(VALUE=other; RHS=self)
            #RETURN_NEW(HEAD=NUMBER; DATA=other - self.data)
            #NEWINSTANCE(OBJ=obj; HEAD=NUMBER; DATA=other - self.data)
            obj = new(cls)
            obj.head = NUMBER
            obj.data = other - self.data
            return obj
        elif lhead is TERMS:
            #SUB_VALUE_TERMS(VALUE=other; RHS=self)
            _tmp17 = other
            try:
                if not _tmp17:
                    #NEG_TERMS(OP=self)
                    op_pairs = self.data
                    if len(op_pairs)==1:
                        t, c = op_pairs.items()[0]
                        c = -c
                        if c==1:
                            return t
                        #RETURN_NEW(HEAD=TERMS; DATA={t:c})
                        #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={t:c})
                        obj = new(cls)
                        obj.head = TERMS
                        obj.data = {t:c}
                        return obj
                    #NEG_DICT_VALUES(DICT_IN=self.data; DICT_OUT=pairs)
                    pairs = dict([(t, -c) for t,c in self.data.iteritems()])
                    #RETURN_NEW(HEAD=TERMS; DATA=pairs)
                    #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA=pairs)
                    obj = new(cls)
                    obj.head = TERMS
                    obj.data = pairs
                    return obj
            except RedirectOperation:
                pass
            #NEG_DICT_VALUES(DICT_IN=self.data; DICT_OUT=pairs)
            pairs = dict([(t, -c) for t,c in self.data.iteritems()])
            one = cls.one
            #ADD_VALUE_DICT(DICT=pairs; VALUE=_tmp17)
            #ADD_TERM_VALUE_DICT(TERM=one; VALUE=_tmp17; DICT=pairs; DICT_GET=pairs.get)
            b = pairs.get(one)
            if b is None:
                pairs[one] = _tmp17
            else:
                c = b + _tmp17
                try:
                    if c:
                        pairs[one] = c
                    else:
                        del pairs[one]
                except RedirectOperation:
                    pairs[one] = c
            #RETURN_NEW(HEAD=TERMS; DATA=pairs)
            #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA=pairs)
            obj = new(cls)
            obj.head = TERMS
            obj.data = pairs
            return obj
        else:
            #SUB_VALUE_SYMBOL(VALUE=other; RHS=self)
            _tmp29 = other
            try:
                if not _tmp29:
                    #RETURN_NEW(HEAD=TERMS; DATA={self: -1})
                    #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={self: -1})
                    obj = new(cls)
                    obj.head = TERMS
                    obj.data = {self: -1}
                    return obj
            except RedirectOperation:
                pass
            #RETURN_NEW(HEAD=TERMS; DATA={cls.one: _tmp29, self: -1})
            #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={cls.one: _tmp29, self: -1})
            obj = new(cls)
            obj.head = TERMS
            obj.data = {cls.one: _tmp29, self: -1}
            return obj
    other = cls.convert(other, False)
    if other is NotImplemented:
        return other
    return other - self

def rdiv_method(self, other, NUMBER=NUMBER, TERMS=TERMS, FACTORS=FACTORS, new=object.__new__):
    cls = self.__class__
    lhead = self.head
    if isinstance(other, cls.coefftypes):
        if lhead is NUMBER:
            #DIV_VALUE_NUMBER(VALUE=other; RHS=self)
            #RETURN_NEW(HEAD=NUMBER; DATA=div(other, self.data))
            #NEWINSTANCE(OBJ=obj; HEAD=NUMBER; DATA=div(other, self.data))
            obj = new(cls)
            obj.head = NUMBER
            obj.data = div(other, self.data)
            return obj
        elif lhead is TERMS:
            #DIV_VALUE_TERMS(VALUE=other; RHS=self)
            #MUL_ZERO_OP(VALUE=other; OP=self)
            try:
                if not other:
                    if self.has_active():
                        #RETURN_NEW(HEAD=TERMS; DATA={self: 0})
                        #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={self: 0})
                        obj = new(cls)
                        obj.head = TERMS
                        obj.data = {self: 0}
                        return obj
                    else:
                        return cls.zero
            except RedirectOperation:
                #RETURN_NEW(HEAD=TERMS; DATA={self: other})
                #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={self: other})
                obj = new(cls)
                obj.head = TERMS
                obj.data = {self: other}
                return obj
            pairs = self.data
            if len(pairs)==1:
                t, c = pairs.items()[0]
                c = div(other, c)
                t = 1/t
                if c==1:
                    return t
                if t==cls.one:
                    return cls.convert(c)
                #RETURN_NEW(HEAD=TERMS; DATA={t: c})
                #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={t: c})
                obj = new(cls)
                obj.head = TERMS
                obj.data = {t: c}
                return obj
            #NEWINSTANCE(OBJ=_tmp37; HEAD=FACTORS; DATA={self: -1})
            _tmp37 = new(cls)
            _tmp37.head = FACTORS
            _tmp37.data = {self: -1}
            if other==1:
                return _tmp37
            #RETURN_NEW(HEAD=TERMS; DATA={_tmp37: other})
            #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={_tmp37: other})
            obj = new(cls)
            obj.head = TERMS
            obj.data = {_tmp37: other}
            return obj
        elif lhead is FACTORS:
            #DIV_VALUE_FACTORS(VALUE=other; RHS=self)
            
            pairs = self.data
            if len(pairs)==1:
                t, c = pairs.items()[0]
                c = -c
                if c==1:
                    return t * other
                new_pairs = {t: c}
            else:
                #NEG_DICT_VALUES(DICT_IN=pairs; DICT_OUT=new_pairs)
                new_pairs = dict([(t, -c) for t,c in pairs.iteritems()])
            #NEWINSTANCE(OBJ=_tmp48; HEAD=FACTORS; DATA=new_pairs)
            _tmp48 = new(cls)
            _tmp48.head = FACTORS
            _tmp48.data = new_pairs
            if other==1:
                return _tmp48
            #RETURN_NEW(HEAD=TERMS; DATA={_tmp48: other})
            #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={_tmp48: other})
            obj = new(cls)
            obj.head = TERMS
            obj.data = {_tmp48: other}
            return obj
        else:
            #DIV_VALUE_SYMBOL(VALUE=other; RHS=self)
            _tmp53 = other
            try:
                if not _tmp53:
                    return cls.zero
            except RedirectOperation:
                pass
            #NEWINSTANCE(OBJ=obj2; HEAD=FACTORS; DATA={self: -1})
            obj2 = new(cls)
            obj2.head = FACTORS
            obj2.data = {self: -1}
            if _tmp53==1:
                return obj2
            #RETURN_NEW(HEAD=TERMS; DATA={obj2: _tmp53})
            #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={obj2: _tmp53})
            obj = new(cls)
            obj.head = TERMS
            obj.data = {obj2: _tmp53}
            return obj
    other = cls.convert(other, False)
    if other is NotImplemented:
        return other
    return other / self

def add_method(self, other, NUMBER=NUMBER, TERMS=TERMS, FACTORS=FACTORS, new=object.__new__):
    cls = self.__class__
    lhead = self.head
    if type(other) is not cls:
        if isinstance(other, cls.coefftypes):
            if lhead is NUMBER:
                #ADD_NUMBER_VALUE(VALUE=other; LHS=self)
                #RETURN_NEW(HEAD=NUMBER; DATA=self.data + other)
                #NEWINSTANCE(OBJ=obj; HEAD=NUMBER; DATA=self.data + other)
                obj = new(cls)
                obj.head = NUMBER
                obj.data = self.data + other
                return obj
            elif lhead is TERMS:
                #ADD_TERMS_VALUE(VALUE=other; LHS=self)
                #ADD_VALUE_TERMS(VALUE=other; RHS=self)
                _tmp61 = other
                try:
                    if not _tmp61:
                        return self
                except RedirectOperation:
                    pass
                pairs = dict(self.data)
                one = cls.one
                #ADD_VALUE_DICT(DICT=pairs; VALUE=_tmp61)
                #ADD_TERM_VALUE_DICT(TERM=one; VALUE=_tmp61; DICT=pairs; DICT_GET=pairs.get)
                b = pairs.get(one)
                if b is None:
                    pairs[one] = _tmp61
                else:
                    c = b + _tmp61
                    try:
                        if c:
                            pairs[one] = c
                        else:
                            del pairs[one]
                    except RedirectOperation:
                        pairs[one] = c
                #RETURN_NEW(HEAD=TERMS; DATA=pairs)
                #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA=pairs)
                obj = new(cls)
                obj.head = TERMS
                obj.data = pairs
                return obj
            else:
                #ADD_SYMBOL_VALUE(VALUE=other; LHS=self)
                #ADD_VALUE_SYMBOL(VALUE=other; RHS=self)
                _tmp67 = other
                try:
                    if not _tmp67:
                        return self
                except RedirectOperation:
                    pass
                #RETURN_NEW(HEAD=TERMS; DATA={cls.one: _tmp67, self: 1})
                #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={cls.one: _tmp67, self: 1})
                obj = new(cls)
                obj.head = TERMS
                obj.data = {cls.one: _tmp67, self: 1}
                return obj
        other = cls.convert(other, False)
        if other is NotImplemented:
            return other
    rhead = other.head
    if lhead is NUMBER:
        if rhead is NUMBER:
            #ADD_NUMBER_NUMBER(LHS=self; RHS=other)
            #ADD_VALUE_NUMBER(VALUE=self.data; RHS=other)
            #RETURN_NEW(HEAD=NUMBER; DATA=self.data + other.data)
            #NEWINSTANCE(OBJ=obj; HEAD=NUMBER; DATA=self.data + other.data)
            obj = new(cls)
            obj.head = NUMBER
            obj.data = self.data + other.data
            return obj
        elif rhead is TERMS:
            #ADD_NUMBER_TERMS(LHS=self; RHS=other)
            #ADD_VALUE_TERMS(VALUE=self.data; RHS=other)
            _tmp75 = self.data
            try:
                if not _tmp75:
                    return other
            except RedirectOperation:
                pass
            pairs = dict(other.data)
            one = cls.one
            #ADD_VALUE_DICT(DICT=pairs; VALUE=_tmp75)
            #ADD_TERM_VALUE_DICT(TERM=one; VALUE=_tmp75; DICT=pairs; DICT_GET=pairs.get)
            b = pairs.get(one)
            if b is None:
                pairs[one] = _tmp75
            else:
                c = b + _tmp75
                try:
                    if c:
                        pairs[one] = c
                    else:
                        del pairs[one]
                except RedirectOperation:
                    pairs[one] = c
            #RETURN_NEW(HEAD=TERMS; DATA=pairs)
            #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA=pairs)
            obj = new(cls)
            obj.head = TERMS
            obj.data = pairs
            return obj
        else:
            #ADD_NUMBER_SYMBOL(LHS=self; RHS=other)
            #ADD_VALUE_SYMBOL(VALUE=self.data; RHS=other)
            _tmp81 = self.data
            try:
                if not _tmp81:
                    return other
            except RedirectOperation:
                pass
            #RETURN_NEW(HEAD=TERMS; DATA={cls.one: _tmp81, other: 1})
            #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={cls.one: _tmp81, other: 1})
            obj = new(cls)
            obj.head = TERMS
            obj.data = {cls.one: _tmp81, other: 1}
            return obj
    elif lhead is TERMS:
        if rhead is NUMBER:
            #ADD_TERMS_NUMBER(LHS=self; RHS=other)
            #ADD_TERMS_VALUE(VALUE=other.data; LHS=self)
            #ADD_VALUE_TERMS(VALUE=other.data; RHS=self)
            _tmp86 = other.data
            try:
                if not _tmp86:
                    return self
            except RedirectOperation:
                pass
            pairs = dict(self.data)
            one = cls.one
            #ADD_VALUE_DICT(DICT=pairs; VALUE=_tmp86)
            #ADD_TERM_VALUE_DICT(TERM=one; VALUE=_tmp86; DICT=pairs; DICT_GET=pairs.get)
            b = pairs.get(one)
            if b is None:
                pairs[one] = _tmp86
            else:
                c = b + _tmp86
                try:
                    if c:
                        pairs[one] = c
                    else:
                        del pairs[one]
                except RedirectOperation:
                    pairs[one] = c
            #RETURN_NEW(HEAD=TERMS; DATA=pairs)
            #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA=pairs)
            obj = new(cls)
            obj.head = TERMS
            obj.data = pairs
            return obj
        elif rhead is TERMS:
            #ADD_TERMS_TERMS(LHS=self; RHS=other)
            pairs = dict(self.data)
            pairs_get = pairs.get
            for t,c in other.data.iteritems():
                #ADD_TERM_VALUE_DICT(TERM=t; VALUE=c; DICT=pairs; DICT_GET=pairs_get)
                b = pairs_get(t)
                if b is None:
                    pairs[t] = c
                else:
                    c = b + c
                    try:
                        if c:
                            pairs[t] = c
                        else:
                            del pairs[t]
                    except RedirectOperation:
                        pairs[t] = c
            #CANONIZE_TERMS_DICT(DICT=pairs)
            if not pairs:
                return cls.zero
            if len(pairs)==1:
               t, c = pairs.items()[0]
               if c==1:
                   return t
               if t==cls.one:
                   return cls.convert(c)
            #RETURN_NEW(HEAD=TERMS; DATA=pairs)
            #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA=pairs)
            obj = new(cls)
            obj.head = TERMS
            obj.data = pairs
            return obj
        else:
            #ADD_TERMS_SYMBOL(LHS=self; RHS=other)
            pairs = dict(self.data)
            #ADD_TERM_VALUE_DICT(TERM=other; VALUE=1; DICT=pairs; DICT_GET=pairs.get)
            b = pairs.get(other)
            if b is None:
                pairs[other] = 1
            else:
                c = b + 1
                try:
                    if c:
                        pairs[other] = c
                    else:
                        del pairs[other]
                except RedirectOperation:
                    pairs[other] = c
            #CANONIZE_TERMS_DICT(DICT=pairs)
            if not pairs:
                return cls.zero
            if len(pairs)==1:
               t, c = pairs.items()[0]
               if c==1:
                   return t
               if t==cls.one:
                   return cls.convert(c)
            #RETURN_NEW(HEAD=TERMS; DATA=pairs)
            #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA=pairs)
            obj = new(cls)
            obj.head = TERMS
            obj.data = pairs
            return obj
    else:
        if rhead is NUMBER:
            #ADD_SYMBOL_NUMBER(LHS=self; RHS=other)
            #ADD_SYMBOL_VALUE(VALUE=other.data; LHS=self)
            #ADD_VALUE_SYMBOL(VALUE=other.data; RHS=self)
            _tmp103 = other.data
            try:
                if not _tmp103:
                    return self
            except RedirectOperation:
                pass
            #RETURN_NEW(HEAD=TERMS; DATA={cls.one: _tmp103, self: 1})
            #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={cls.one: _tmp103, self: 1})
            obj = new(cls)
            obj.head = TERMS
            obj.data = {cls.one: _tmp103, self: 1}
            return obj
        elif rhead is TERMS:
            #ADD_SYMBOL_TERMS(LHS=self; RHS=other)
            #ADD_TERMS_SYMBOL(LHS=other; RHS=self)
            pairs = dict(other.data)
            #ADD_TERM_VALUE_DICT(TERM=self; VALUE=1; DICT=pairs; DICT_GET=pairs.get)
            b = pairs.get(self)
            if b is None:
                pairs[self] = 1
            else:
                c = b + 1
                try:
                    if c:
                        pairs[self] = c
                    else:
                        del pairs[self]
                except RedirectOperation:
                    pairs[self] = c
            #CANONIZE_TERMS_DICT(DICT=pairs)
            if not pairs:
                return cls.zero
            if len(pairs)==1:
               t, c = pairs.items()[0]
               if c==1:
                   return t
               if t==cls.one:
                   return cls.convert(c)
            #RETURN_NEW(HEAD=TERMS; DATA=pairs)
            #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA=pairs)
            obj = new(cls)
            obj.head = TERMS
            obj.data = pairs
            return obj
        else:
            #ADD_SYMBOL_SYMBOL(LHS=self; RHS=other)
            if self == other:
                pairs = {self: 2}
            else:
                pairs = {self: 1, other: 1}
            #RETURN_NEW(HEAD=TERMS; DATA=pairs)
            #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA=pairs)
            obj = new(cls)
            obj.head = TERMS
            obj.data = pairs
            return obj

def sub_method(self, other, NUMBER=NUMBER, TERMS=TERMS, FACTORS=FACTORS, new=object.__new__):
    cls = self.__class__
    lhead = self.head
    if type(other) is not cls:
        if isinstance(other, cls.coefftypes):
            if lhead is NUMBER:
                #SUB_NUMBER_VALUE(VALUE=other; LHS=self)
                #RETURN_NEW(HEAD=NUMBER; DATA=self.data - other)
                #NEWINSTANCE(OBJ=obj; HEAD=NUMBER; DATA=self.data - other)
                obj = new(cls)
                obj.head = NUMBER
                obj.data = self.data - other
                return obj
            elif lhead is TERMS:
                #SUB_TERMS_VALUE(VALUE=other; LHS=self)
                #ADD_VALUE_TERMS(VALUE=-other; RHS=self)
                _tmp119 = -other
                try:
                    if not _tmp119:
                        return self
                except RedirectOperation:
                    pass
                pairs = dict(self.data)
                one = cls.one
                #ADD_VALUE_DICT(DICT=pairs; VALUE=_tmp119)
                #ADD_TERM_VALUE_DICT(TERM=one; VALUE=_tmp119; DICT=pairs; DICT_GET=pairs.get)
                b = pairs.get(one)
                if b is None:
                    pairs[one] = _tmp119
                else:
                    c = b + _tmp119
                    try:
                        if c:
                            pairs[one] = c
                        else:
                            del pairs[one]
                    except RedirectOperation:
                        pairs[one] = c
                #RETURN_NEW(HEAD=TERMS; DATA=pairs)
                #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA=pairs)
                obj = new(cls)
                obj.head = TERMS
                obj.data = pairs
                return obj
            else:
                #SUB_SYMBOL_VALUE(VALUE=other; LHS=self)
                #ADD_SYMBOL_VALUE(OBJ=obj; LHS=self; VALUE=-other)
                #ADD_VALUE_SYMBOL(VALUE=-other; RHS=self)
                _tmp126 = -other
                try:
                    if not _tmp126:
                        return self
                except RedirectOperation:
                    pass
                #RETURN_NEW(HEAD=TERMS; DATA={cls.one: _tmp126, self: 1})
                #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={cls.one: _tmp126, self: 1})
                obj = new(cls)
                obj.head = TERMS
                obj.data = {cls.one: _tmp126, self: 1}
                return obj
        other = cls.convert(other, False)
        if other is NotImplemented:
            return other
    rhead = other.head
    if lhead is NUMBER:
        if rhead is NUMBER:
            #SUB_NUMBER_NUMBER(LHS=self; RHS=other)
            #SUB_VALUE_NUMBER(VALUE=self.data; RHS=other)
            #RETURN_NEW(HEAD=NUMBER; DATA=self.data - other.data)
            #NEWINSTANCE(OBJ=obj; HEAD=NUMBER; DATA=self.data - other.data)
            obj = new(cls)
            obj.head = NUMBER
            obj.data = self.data - other.data
            return obj
        elif rhead is TERMS:
            #SUB_NUMBER_TERMS(LHS=self; RHS=other)
            #SUB_VALUE_TERMS(VALUE=self.data; RHS=other)
            _tmp134 = self.data
            try:
                if not _tmp134:
                    #NEG_TERMS(OP=other)
                    op_pairs = other.data
                    if len(op_pairs)==1:
                        t, c = op_pairs.items()[0]
                        c = -c
                        if c==1:
                            return t
                        #RETURN_NEW(HEAD=TERMS; DATA={t:c})
                        #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={t:c})
                        obj = new(cls)
                        obj.head = TERMS
                        obj.data = {t:c}
                        return obj
                    #NEG_DICT_VALUES(DICT_IN=other.data; DICT_OUT=pairs)
                    pairs = dict([(t, -c) for t,c in other.data.iteritems()])
                    #RETURN_NEW(HEAD=TERMS; DATA=pairs)
                    #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA=pairs)
                    obj = new(cls)
                    obj.head = TERMS
                    obj.data = pairs
                    return obj
            except RedirectOperation:
                pass
            #NEG_DICT_VALUES(DICT_IN=other.data; DICT_OUT=pairs)
            pairs = dict([(t, -c) for t,c in other.data.iteritems()])
            one = cls.one
            #ADD_VALUE_DICT(DICT=pairs; VALUE=_tmp134)
            #ADD_TERM_VALUE_DICT(TERM=one; VALUE=_tmp134; DICT=pairs; DICT_GET=pairs.get)
            b = pairs.get(one)
            if b is None:
                pairs[one] = _tmp134
            else:
                c = b + _tmp134
                try:
                    if c:
                        pairs[one] = c
                    else:
                        del pairs[one]
                except RedirectOperation:
                    pairs[one] = c
            #RETURN_NEW(HEAD=TERMS; DATA=pairs)
            #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA=pairs)
            obj = new(cls)
            obj.head = TERMS
            obj.data = pairs
            return obj
        else:
            #SUB_NUMBER_SYMBOL(LHS=self; RHS=other)
            #SUB_VALUE_SYMBOL(VALUE=self.data; RHS=other)
            _tmp147 = self.data
            try:
                if not _tmp147:
                    #RETURN_NEW(HEAD=TERMS; DATA={other: -1})
                    #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={other: -1})
                    obj = new(cls)
                    obj.head = TERMS
                    obj.data = {other: -1}
                    return obj
            except RedirectOperation:
                pass
            #RETURN_NEW(HEAD=TERMS; DATA={cls.one: _tmp147, other: -1})
            #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={cls.one: _tmp147, other: -1})
            obj = new(cls)
            obj.head = TERMS
            obj.data = {cls.one: _tmp147, other: -1}
            return obj
    elif lhead is TERMS:
        if rhead is NUMBER:
            #SUB_TERMS_NUMBER(LHS=self; RHS=other)
            #SUB_TERMS_VALUE(VALUE=other.data; LHS=self)
            #ADD_VALUE_TERMS(VALUE=-other.data; RHS=self)
            _tmp154 = -other.data
            try:
                if not _tmp154:
                    return self
            except RedirectOperation:
                pass
            pairs = dict(self.data)
            one = cls.one
            #ADD_VALUE_DICT(DICT=pairs; VALUE=_tmp154)
            #ADD_TERM_VALUE_DICT(TERM=one; VALUE=_tmp154; DICT=pairs; DICT_GET=pairs.get)
            b = pairs.get(one)
            if b is None:
                pairs[one] = _tmp154
            else:
                c = b + _tmp154
                try:
                    if c:
                        pairs[one] = c
                    else:
                        del pairs[one]
                except RedirectOperation:
                    pairs[one] = c
            #RETURN_NEW(HEAD=TERMS; DATA=pairs)
            #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA=pairs)
            obj = new(cls)
            obj.head = TERMS
            obj.data = pairs
            return obj
        elif rhead is TERMS:
            #SUB_TERMS_TERMS(LHS=self; RHS=other)
            pairs = dict(self.data)
            pairs_get = pairs.get
            for t,c in other.data.iteritems():
                #ADD_TERM_VALUE_DICT(TERM=t; VALUE=-c; DICT=pairs; DICT_GET=pairs_get)
                b = pairs_get(t)
                if b is None:
                    pairs[t] = -c
                else:
                    c = b + -c
                    try:
                        if c:
                            pairs[t] = c
                        else:
                            del pairs[t]
                    except RedirectOperation:
                        pairs[t] = c
            #CANONIZE_TERMS_DICT(DICT=pairs)
            if not pairs:
                return cls.zero
            if len(pairs)==1:
               t, c = pairs.items()[0]
               if c==1:
                   return t
               if t==cls.one:
                   return cls.convert(c)
            #RETURN_NEW(HEAD=TERMS; DATA=pairs)
            #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA=pairs)
            obj = new(cls)
            obj.head = TERMS
            obj.data = pairs
            return obj
        else:
            #SUB_TERMS_SYMBOL(LHS=self; RHS=other)
            pairs = dict(self.data)
            #ADD_TERM_VALUE_DICT(TERM=other; VALUE=-1; DICT=pairs; DICT_GET=pairs.get)
            b = pairs.get(other)
            if b is None:
                pairs[other] = -1
            else:
                c = b + -1
                try:
                    if c:
                        pairs[other] = c
                    else:
                        del pairs[other]
                except RedirectOperation:
                    pairs[other] = c
            #CANONIZE_TERMS_DICT(DICT=pairs)
            if not pairs:
                return cls.zero
            if len(pairs)==1:
               t, c = pairs.items()[0]
               if c==1:
                   return t
               if t==cls.one:
                   return cls.convert(c)
            #RETURN_NEW(HEAD=TERMS; DATA=pairs)
            #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA=pairs)
            obj = new(cls)
            obj.head = TERMS
            obj.data = pairs
            return obj
    else:
        if rhead is NUMBER:
            #SUB_SYMBOL_NUMBER(LHS=self; RHS=other)
            #SUB_SYMBOL_VALUE(VALUE=other.data; LHS=self)
            #ADD_SYMBOL_VALUE(OBJ=obj; LHS=self; VALUE=-other.data)
            #ADD_VALUE_SYMBOL(VALUE=-other.data; RHS=self)
            _tmp172 = -other.data
            try:
                if not _tmp172:
                    return self
            except RedirectOperation:
                pass
            #RETURN_NEW(HEAD=TERMS; DATA={cls.one: _tmp172, self: 1})
            #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={cls.one: _tmp172, self: 1})
            obj = new(cls)
            obj.head = TERMS
            obj.data = {cls.one: _tmp172, self: 1}
            return obj
        elif rhead is TERMS:
            #SUB_SYMBOL_TERMS(LHS=self; RHS=other)
            #NEG_DICT_VALUES(DICT_IN=other.data; DICT_OUT=pairs)
            pairs = dict([(t, -c) for t,c in other.data.iteritems()])
            #ADD_TERM_VALUE_DICT(TERM=self; VALUE=1; DICT=pairs; DICT_GET=pairs.get)
            b = pairs.get(self)
            if b is None:
                pairs[self] = 1
            else:
                c = b + 1
                try:
                    if c:
                        pairs[self] = c
                    else:
                        del pairs[self]
                except RedirectOperation:
                    pairs[self] = c
            #CANONIZE_TERMS_DICT(DICT=pairs)
            if not pairs:
                return cls.zero
            if len(pairs)==1:
               t, c = pairs.items()[0]
               if c==1:
                   return t
               if t==cls.one:
                   return cls.convert(c)
            #RETURN_NEW(HEAD=TERMS; DATA=pairs)
            #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA=pairs)
            obj = new(cls)
            obj.head = TERMS
            obj.data = pairs
            return obj
        else:
            #SUB_SYMBOL_SYMBOL(LHS=self; RHS=other)
            if self == other:
                return cls.zero
            #RETURN_NEW(HEAD=TERMS; DATA={self: 1, other: -1})
            #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={self: 1, other: -1})
            obj = new(cls)
            obj.head = TERMS
            obj.data = {self: 1, other: -1}
            return obj

def mul_method(self, other, NUMBER=NUMBER, TERMS=TERMS, FACTORS=FACTORS, new=object.__new__):
    cls = self.__class__
    lhead = self.head
    if type(other) is not cls:
        if isinstance(other, cls.coefftypes):
            if lhead is NUMBER:
                #MUL_NUMBER_VALUE(VALUE=other; LHS=self)
                #RETURN_NEW(HEAD=NUMBER; DATA=self.data * other)
                #NEWINSTANCE(OBJ=obj; HEAD=NUMBER; DATA=self.data * other)
                obj = new(cls)
                obj.head = NUMBER
                obj.data = self.data * other
                return obj
            elif lhead is TERMS:
                #MUL_TERMS_VALUE(VALUE=other; LHS=self)
                #MUL_VALUE_TERMS(VALUE=other; RHS=self)
                _tmp188 = other
                #MUL_ZERO_OP(VALUE=_tmp188; OP=self)
                try:
                    if not _tmp188:
                        if self.has_active():
                            #RETURN_NEW(HEAD=TERMS; DATA={self: 0})
                            #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={self: 0})
                            obj = new(cls)
                            obj.head = TERMS
                            obj.data = {self: 0}
                            return obj
                        else:
                            return cls.zero
                except RedirectOperation:
                    #RETURN_NEW(HEAD=TERMS; DATA={self: _tmp188})
                    #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={self: _tmp188})
                    obj = new(cls)
                    obj.head = TERMS
                    obj.data = {self: _tmp188}
                    return obj
                pairs = self.data
                if len(pairs)==1:
                    t, c = pairs.items()[0]
                    c = _tmp188 * c
                    if c==1:
                        return t
                    #RETURN_NEW(HEAD=TERMS; DATA={t: c})
                    #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={t: c})
                    obj = new(cls)
                    obj.head = TERMS
                    obj.data = {t: c}
                    return obj
                if _tmp188==1:
                    return self
                pairs = {}
                for t,c in self.data.iteritems():
                    c = _tmp188 * c
                    try:
                        if c or t.has_active():
                            pairs[t] = c
                    except RedirectOperation:
                        pairs[t] = c
                #CANONIZE_TERMS_DICT(DICT=pairs)
                if not pairs:
                    return cls.zero
                if len(pairs)==1:
                   t, c = pairs.items()[0]
                   if c==1:
                       return t
                   if t==cls.one:
                       return cls.convert(c)
                #RETURN_NEW(HEAD=TERMS; DATA=pairs)
                #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA=pairs)
                obj = new(cls)
                obj.head = TERMS
                obj.data = pairs
                return obj
            elif lhead is FACTORS:
                #MUL_FACTORS_VALUE(VALUE=other; LHS=self)
                #MUL_SYMBOL_VALUE(VALUE=other; LHS=self)
                #MUL_VALUE_SYMBOL(VALUE=other; RHS=self)
                _tmp201 = other
                #MUL_ZERO_OP(VALUE=_tmp201; OP=self)
                try:
                    if not _tmp201:
                        if self.has_active():
                            #RETURN_NEW(HEAD=TERMS; DATA={self: 0})
                            #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={self: 0})
                            obj = new(cls)
                            obj.head = TERMS
                            obj.data = {self: 0}
                            return obj
                        else:
                            return cls.zero
                except RedirectOperation:
                    #RETURN_NEW(HEAD=TERMS; DATA={self: _tmp201})
                    #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={self: _tmp201})
                    obj = new(cls)
                    obj.head = TERMS
                    obj.data = {self: _tmp201}
                    return obj
                if _tmp201==1:
                    return self
                #RETURN_NEW(HEAD=TERMS; DATA={self: _tmp201})
                #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={self: _tmp201})
                obj = new(cls)
                obj.head = TERMS
                obj.data = {self: _tmp201}
                return obj
            else:
                #MUL_SYMBOL_VALUE(VALUE=other; LHS=self)
                #MUL_VALUE_SYMBOL(VALUE=other; RHS=self)
                _tmp210 = other
                #MUL_ZERO_OP(VALUE=_tmp210; OP=self)
                try:
                    if not _tmp210:
                        if self.has_active():
                            #RETURN_NEW(HEAD=TERMS; DATA={self: 0})
                            #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={self: 0})
                            obj = new(cls)
                            obj.head = TERMS
                            obj.data = {self: 0}
                            return obj
                        else:
                            return cls.zero
                except RedirectOperation:
                    #RETURN_NEW(HEAD=TERMS; DATA={self: _tmp210})
                    #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={self: _tmp210})
                    obj = new(cls)
                    obj.head = TERMS
                    obj.data = {self: _tmp210}
                    return obj
                if _tmp210==1:
                    return self
                #RETURN_NEW(HEAD=TERMS; DATA={self: _tmp210})
                #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={self: _tmp210})
                obj = new(cls)
                obj.head = TERMS
                obj.data = {self: _tmp210}
                return obj
        other = cls.convert(other, False)
        if other is NotImplemented:
            return other
    rhead = other.head
    if lhead is NUMBER:
        if rhead is NUMBER:
            #MUL_NUMBER_NUMBER(LHS=self; RHS=other)
            #MUL_VALUE_NUMBER(VALUE=self.data; RHS=other)
            #RETURN_NEW(HEAD=NUMBER; DATA=self.data * other.data)
            #NEWINSTANCE(OBJ=obj; HEAD=NUMBER; DATA=self.data * other.data)
            obj = new(cls)
            obj.head = NUMBER
            obj.data = self.data * other.data
            return obj
        elif rhead is TERMS:
            #MUL_NUMBER_TERMS(LHS=self; RHS=other)
            #MUL_VALUE_TERMS(VALUE=self.data; RHS=other)
            _tmp223 = self.data
            #MUL_ZERO_OP(VALUE=_tmp223; OP=other)
            try:
                if not _tmp223:
                    if other.has_active():
                        #RETURN_NEW(HEAD=TERMS; DATA={other: 0})
                        #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={other: 0})
                        obj = new(cls)
                        obj.head = TERMS
                        obj.data = {other: 0}
                        return obj
                    else:
                        return cls.zero
            except RedirectOperation:
                #RETURN_NEW(HEAD=TERMS; DATA={other: _tmp223})
                #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={other: _tmp223})
                obj = new(cls)
                obj.head = TERMS
                obj.data = {other: _tmp223}
                return obj
            pairs = other.data
            if len(pairs)==1:
                t, c = pairs.items()[0]
                c = _tmp223 * c
                if c==1:
                    return t
                #RETURN_NEW(HEAD=TERMS; DATA={t: c})
                #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={t: c})
                obj = new(cls)
                obj.head = TERMS
                obj.data = {t: c}
                return obj
            if _tmp223==1:
                return other
            pairs = {}
            for t,c in other.data.iteritems():
                c = _tmp223 * c
                try:
                    if c or t.has_active():
                        pairs[t] = c
                except RedirectOperation:
                    pairs[t] = c
            #CANONIZE_TERMS_DICT(DICT=pairs)
            if not pairs:
                return cls.zero
            if len(pairs)==1:
               t, c = pairs.items()[0]
               if c==1:
                   return t
               if t==cls.one:
                   return cls.convert(c)
            #RETURN_NEW(HEAD=TERMS; DATA=pairs)
            #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA=pairs)
            obj = new(cls)
            obj.head = TERMS
            obj.data = pairs
            return obj
        elif rhead is FACTORS:
            #MUL_NUMBER_FACTORS(LHS=self; RHS=other)
            #MUL_SYMBOL_VALUE(VALUE=self.data; LHS=other)
            #MUL_VALUE_SYMBOL(VALUE=self.data; RHS=other)
            _tmp236 = self.data
            #MUL_ZERO_OP(VALUE=_tmp236; OP=other)
            try:
                if not _tmp236:
                    if other.has_active():
                        #RETURN_NEW(HEAD=TERMS; DATA={other: 0})
                        #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={other: 0})
                        obj = new(cls)
                        obj.head = TERMS
                        obj.data = {other: 0}
                        return obj
                    else:
                        return cls.zero
            except RedirectOperation:
                #RETURN_NEW(HEAD=TERMS; DATA={other: _tmp236})
                #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={other: _tmp236})
                obj = new(cls)
                obj.head = TERMS
                obj.data = {other: _tmp236}
                return obj
            if _tmp236==1:
                return other
            #RETURN_NEW(HEAD=TERMS; DATA={other: _tmp236})
            #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={other: _tmp236})
            obj = new(cls)
            obj.head = TERMS
            obj.data = {other: _tmp236}
            return obj
        else:
            #MUL_NUMBER_SYMBOL(LHS=self; RHS=other)
            #MUL_VALUE_SYMBOL(VALUE=self.data; RHS=other)
            _tmp245 = self.data
            #MUL_ZERO_OP(VALUE=_tmp245; OP=other)
            try:
                if not _tmp245:
                    if other.has_active():
                        #RETURN_NEW(HEAD=TERMS; DATA={other: 0})
                        #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={other: 0})
                        obj = new(cls)
                        obj.head = TERMS
                        obj.data = {other: 0}
                        return obj
                    else:
                        return cls.zero
            except RedirectOperation:
                #RETURN_NEW(HEAD=TERMS; DATA={other: _tmp245})
                #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={other: _tmp245})
                obj = new(cls)
                obj.head = TERMS
                obj.data = {other: _tmp245}
                return obj
            if _tmp245==1:
                return other
            #RETURN_NEW(HEAD=TERMS; DATA={other: _tmp245})
            #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={other: _tmp245})
            obj = new(cls)
            obj.head = TERMS
            obj.data = {other: _tmp245}
            return obj
    elif lhead is TERMS:
        if rhead is NUMBER:
            #MUL_TERMS_NUMBER(LHS=self; RHS=other)
            #MUL_TERMS_VALUE(VALUE=other.data; LHS=self)
            #MUL_VALUE_TERMS(VALUE=other.data; RHS=self)
            _tmp255 = other.data
            #MUL_ZERO_OP(VALUE=_tmp255; OP=self)
            try:
                if not _tmp255:
                    if self.has_active():
                        #RETURN_NEW(HEAD=TERMS; DATA={self: 0})
                        #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={self: 0})
                        obj = new(cls)
                        obj.head = TERMS
                        obj.data = {self: 0}
                        return obj
                    else:
                        return cls.zero
            except RedirectOperation:
                #RETURN_NEW(HEAD=TERMS; DATA={self: _tmp255})
                #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={self: _tmp255})
                obj = new(cls)
                obj.head = TERMS
                obj.data = {self: _tmp255}
                return obj
            pairs = self.data
            if len(pairs)==1:
                t, c = pairs.items()[0]
                c = _tmp255 * c
                if c==1:
                    return t
                #RETURN_NEW(HEAD=TERMS; DATA={t: c})
                #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={t: c})
                obj = new(cls)
                obj.head = TERMS
                obj.data = {t: c}
                return obj
            if _tmp255==1:
                return self
            pairs = {}
            for t,c in self.data.iteritems():
                c = _tmp255 * c
                try:
                    if c or t.has_active():
                        pairs[t] = c
                except RedirectOperation:
                    pairs[t] = c
            #CANONIZE_TERMS_DICT(DICT=pairs)
            if not pairs:
                return cls.zero
            if len(pairs)==1:
               t, c = pairs.items()[0]
               if c==1:
                   return t
               if t==cls.one:
                   return cls.convert(c)
            #RETURN_NEW(HEAD=TERMS; DATA=pairs)
            #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA=pairs)
            obj = new(cls)
            obj.head = TERMS
            obj.data = pairs
            return obj
        elif rhead is TERMS:
            #MUL_TERMS_TERMS(LHS=self; RHS=other)
            lpairs = self.data
            rpairs = other.data
            if len(lpairs)==1:
                t1,c1 = lpairs.items()[0]
                if len(rpairs)==1:
                    t2,c2 = rpairs.items()[0]
                    t = t1 * t2
                    c = c1 * c2
                    if t == cls.one:
                        return cls.convert(c)
                    if c==1:
                        return t
                    #RETURN_NEW(HEAD=TERMS; DATA={t: c})
                    #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={t: c})
                    obj = new(cls)
                    obj.head = TERMS
                    obj.data = {t: c}
                    return obj
                t = t1 * other
                #RETURN_NEW(HEAD=TERMS; DATA={t: c1})
                #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={t: c1})
                obj = new(cls)
                obj.head = TERMS
                obj.data = {t: c1}
                return obj
            elif len(rpairs)==1:
                t1,c1 = rpairs.items()[0]
                t = t1 * self
                #RETURN_NEW(HEAD=TERMS; DATA={t: c1})
                #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={t: c1})
                obj = new(cls)
                obj.head = TERMS
                obj.data = {t: c1}
                return obj
            if self==other:
                pairs = {self: 2}
            else:
                pairs = {self: 1, other: 1}
            #RETURN_NEW(HEAD=FACTORS; DATA=pairs)
            #NEWINSTANCE(OBJ=obj; HEAD=FACTORS; DATA=pairs)
            obj = new(cls)
            obj.head = FACTORS
            obj.data = pairs
            return obj
        elif rhead is FACTORS:
            #MUL_TERMS_FACTORS(LHS=self; RHS=other)
            #MUL_FACTORS_TERMS(LHS=other; RHS=self)
            rpairs = self.data
            if len(rpairs)==1:
                t1,c1 = rpairs.items()[0]
                t = t1 * other
                #RETURN_NEW(HEAD=TERMS; DATA={t: c1})
                #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={t: c1})
                obj = new(cls)
                obj.head = TERMS
                obj.data = {t: c1}
                return obj
            #MUL_FACTORS_SYMBOL(LHS=other; RHS=self)
            pairs = dict(other.data)
            #MUL_DICT_SYMBOL(DICT=pairs; RHS=self)
            #ADD_TERM_VALUE_DICT(TERM=self; VALUE=1; DICT=pairs; DICT_GET=pairs.get)
            b = pairs.get(self)
            if b is None:
                pairs[self] = 1
            else:
                c = b + 1
                try:
                    if c:
                        pairs[self] = c
                    else:
                        del pairs[self]
                except RedirectOperation:
                    pairs[self] = c
            #CANONIZE_FACTORS_DICT1(DICT=pairs)
            if not pairs:
                return cls.one
            if len(pairs)==1:
               t, c = pairs.items()[0]
               if c==1:
                   return t
               if t==cls.one:
                   return t
            #RETURN_NEW(HEAD=FACTORS; DATA=pairs)
            #NEWINSTANCE(OBJ=obj; HEAD=FACTORS; DATA=pairs)
            obj = new(cls)
            obj.head = FACTORS
            obj.data = pairs
            return obj
        else:
            #MUL_TERMS_SYMBOL(LHS=self; RHS=other)
            pairs = self.data
            if len(pairs)==1:
                t,c = pairs.items()[0]
                t = t * other
                if t==cls.one:
                    return cls.convert(c)
                #RETURN_NEW(HEAD=TERMS; DATA={t: c})
                #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={t: c})
                obj = new(cls)
                obj.head = TERMS
                obj.data = {t: c}
                return obj
            #RETURN_NEW(HEAD=FACTORS; DATA={self: 1, other: 1})
            #NEWINSTANCE(OBJ=obj; HEAD=FACTORS; DATA={self: 1, other: 1})
            obj = new(cls)
            obj.head = FACTORS
            obj.data = {self: 1, other: 1}
            return obj
    elif lhead is FACTORS:
        if rhead is NUMBER:
            #MUL_FACTORS_NUMBER(LHS=self; RHS=other)
            #MUL_SYMBOL_VALUE(VALUE=other.data; LHS=self)
            #MUL_VALUE_SYMBOL(VALUE=other.data; RHS=self)
            _tmp292 = other.data
            #MUL_ZERO_OP(VALUE=_tmp292; OP=self)
            try:
                if not _tmp292:
                    if self.has_active():
                        #RETURN_NEW(HEAD=TERMS; DATA={self: 0})
                        #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={self: 0})
                        obj = new(cls)
                        obj.head = TERMS
                        obj.data = {self: 0}
                        return obj
                    else:
                        return cls.zero
            except RedirectOperation:
                #RETURN_NEW(HEAD=TERMS; DATA={self: _tmp292})
                #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={self: _tmp292})
                obj = new(cls)
                obj.head = TERMS
                obj.data = {self: _tmp292}
                return obj
            if _tmp292==1:
                return self
            #RETURN_NEW(HEAD=TERMS; DATA={self: _tmp292})
            #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={self: _tmp292})
            obj = new(cls)
            obj.head = TERMS
            obj.data = {self: _tmp292}
            return obj
        elif rhead is TERMS:
            #MUL_FACTORS_TERMS(LHS=self; RHS=other)
            rpairs = other.data
            if len(rpairs)==1:
                t1,c1 = rpairs.items()[0]
                t = t1 * self
                #RETURN_NEW(HEAD=TERMS; DATA={t: c1})
                #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={t: c1})
                obj = new(cls)
                obj.head = TERMS
                obj.data = {t: c1}
                return obj
            #MUL_FACTORS_SYMBOL(LHS=self; RHS=other)
            pairs = dict(self.data)
            #MUL_DICT_SYMBOL(DICT=pairs; RHS=other)
            #ADD_TERM_VALUE_DICT(TERM=other; VALUE=1; DICT=pairs; DICT_GET=pairs.get)
            b = pairs.get(other)
            if b is None:
                pairs[other] = 1
            else:
                c = b + 1
                try:
                    if c:
                        pairs[other] = c
                    else:
                        del pairs[other]
                except RedirectOperation:
                    pairs[other] = c
            #CANONIZE_FACTORS_DICT1(DICT=pairs)
            if not pairs:
                return cls.one
            if len(pairs)==1:
               t, c = pairs.items()[0]
               if c==1:
                   return t
               if t==cls.one:
                   return t
            #RETURN_NEW(HEAD=FACTORS; DATA=pairs)
            #NEWINSTANCE(OBJ=obj; HEAD=FACTORS; DATA=pairs)
            obj = new(cls)
            obj.head = FACTORS
            obj.data = pairs
            return obj
        elif rhead is FACTORS:
            #MUL_FACTORS_FACTORS(LHS=self; RHS=other)
            pairs = dict(self.data)
            pairs_get = pairs.get
            number = 1
            for t,c in other.data.iteritems():
                #MUL_FACTOR_VALUE_DICT(FACTOR=t; VALUE=c; DICT=pairs; DICT_GET=pairs_get; NUMBER=number)
                b = pairs_get(t)
                if b is None:
                    pairs[t] = c
                else:
                    _tmp310 = b + c
                    try:
                        if _tmp310:
                            if t.head is NUMBER:
                                r = t ** _tmp310
                                if r.head is NUMBER:
                                    number *= r
                                    del pairs[t]
                                else:
                                    pairs[t] = _tmp310
                            else:
                                pairs[t] = _tmp310
                        else:
                            del pairs[t]
                    except RedirectOperation:
                        pairs[t] = _tmp310
            #CANONIZE_FACTORS_DICT(DICT=pairs; NUMBER=number)
            if not pairs:
                if number is 1:
                    return cls.one
                return number
            if len(pairs)==1:
               t, c = pairs.items()[0]
               if c==1:
                   return t * number
               if t==cls.one:
                   return number
            if number is 1:
                #RETURN_NEW(HEAD=FACTORS; DATA=pairs)
                #NEWINSTANCE(OBJ=obj; HEAD=FACTORS; DATA=pairs)
                obj = new(cls)
                obj.head = FACTORS
                obj.data = pairs
                return obj
            #NEWINSTANCE(OBJ=obj; HEAD=FACTORS; DATA=pairs)
            obj = new(cls)
            obj.head = FACTORS
            obj.data = pairs
            return obj * number
        else:
            #MUL_FACTORS_SYMBOL(LHS=self; RHS=other)
            pairs = dict(self.data)
            #MUL_DICT_SYMBOL(DICT=pairs; RHS=other)
            #ADD_TERM_VALUE_DICT(TERM=other; VALUE=1; DICT=pairs; DICT_GET=pairs.get)
            b = pairs.get(other)
            if b is None:
                pairs[other] = 1
            else:
                c = b + 1
                try:
                    if c:
                        pairs[other] = c
                    else:
                        del pairs[other]
                except RedirectOperation:
                    pairs[other] = c
            #CANONIZE_FACTORS_DICT1(DICT=pairs)
            if not pairs:
                return cls.one
            if len(pairs)==1:
               t, c = pairs.items()[0]
               if c==1:
                   return t
               if t==cls.one:
                   return t
            #RETURN_NEW(HEAD=FACTORS; DATA=pairs)
            #NEWINSTANCE(OBJ=obj; HEAD=FACTORS; DATA=pairs)
            obj = new(cls)
            obj.head = FACTORS
            obj.data = pairs
            return obj
    else:
        if rhead is NUMBER:
            #MUL_SYMBOL_NUMBER(LHS=self; RHS=other)
            #MUL_SYMBOL_VALUE(VALUE=other.data; LHS=self)
            #MUL_VALUE_SYMBOL(VALUE=other.data; RHS=self)
            _tmp323 = other.data
            #MUL_ZERO_OP(VALUE=_tmp323; OP=self)
            try:
                if not _tmp323:
                    if self.has_active():
                        #RETURN_NEW(HEAD=TERMS; DATA={self: 0})
                        #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={self: 0})
                        obj = new(cls)
                        obj.head = TERMS
                        obj.data = {self: 0}
                        return obj
                    else:
                        return cls.zero
            except RedirectOperation:
                #RETURN_NEW(HEAD=TERMS; DATA={self: _tmp323})
                #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={self: _tmp323})
                obj = new(cls)
                obj.head = TERMS
                obj.data = {self: _tmp323}
                return obj
            if _tmp323==1:
                return self
            #RETURN_NEW(HEAD=TERMS; DATA={self: _tmp323})
            #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={self: _tmp323})
            obj = new(cls)
            obj.head = TERMS
            obj.data = {self: _tmp323}
            return obj
        elif rhead is TERMS:
            #MUL_SYMBOL_TERMS(LHS=self; RHS=other)
            #MUL_TERMS_SYMBOL(LHS=other; RHS=self)
            pairs = other.data
            if len(pairs)==1:
                t,c = pairs.items()[0]
                t = t * self
                if t==cls.one:
                    return cls.convert(c)
                #RETURN_NEW(HEAD=TERMS; DATA={t: c})
                #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={t: c})
                obj = new(cls)
                obj.head = TERMS
                obj.data = {t: c}
                return obj
            #RETURN_NEW(HEAD=FACTORS; DATA={other: 1, self: 1})
            #NEWINSTANCE(OBJ=obj; HEAD=FACTORS; DATA={other: 1, self: 1})
            obj = new(cls)
            obj.head = FACTORS
            obj.data = {other: 1, self: 1}
            return obj
        elif rhead is FACTORS:
            #MUL_SYMBOL_FACTORS(LHS=self; RHS=other)
            #MUL_FACTORS_SYMBOL(LHS=other; RHS=self)
            pairs = dict(other.data)
            #MUL_DICT_SYMBOL(DICT=pairs; RHS=self)
            #ADD_TERM_VALUE_DICT(TERM=self; VALUE=1; DICT=pairs; DICT_GET=pairs.get)
            b = pairs.get(self)
            if b is None:
                pairs[self] = 1
            else:
                c = b + 1
                try:
                    if c:
                        pairs[self] = c
                    else:
                        del pairs[self]
                except RedirectOperation:
                    pairs[self] = c
            #CANONIZE_FACTORS_DICT1(DICT=pairs)
            if not pairs:
                return cls.one
            if len(pairs)==1:
               t, c = pairs.items()[0]
               if c==1:
                   return t
               if t==cls.one:
                   return t
            #RETURN_NEW(HEAD=FACTORS; DATA=pairs)
            #NEWINSTANCE(OBJ=obj; HEAD=FACTORS; DATA=pairs)
            obj = new(cls)
            obj.head = FACTORS
            obj.data = pairs
            return obj
        else:
            #MUL_SYMBOL_SYMBOL(LHS=self; RHS=other)
            if self == other:
                pairs = {self: 2}
            else:
                pairs = {self: 1, other: 1}
            #RETURN_NEW(HEAD=FACTORS; DATA=pairs)
            #NEWINSTANCE(OBJ=obj; HEAD=FACTORS; DATA=pairs)
            obj = new(cls)
            obj.head = FACTORS
            obj.data = pairs
            return obj

def div_method(self, other, NUMBER=NUMBER, TERMS=TERMS, FACTORS=FACTORS, new=object.__new__):
    cls = self.__class__
    lhead = self.head
    if type(other) is not cls:
        if isinstance(other, cls.coefftypes):
            if lhead is NUMBER:
                #DIV_NUMBER_VALUE(VALUE=other; LHS=self)
                #RETURN_NEW(HEAD=NUMBER; DATA=div(self.data, other))
                #NEWINSTANCE(OBJ=obj; HEAD=NUMBER; DATA=div(self.data, other))
                obj = new(cls)
                obj.head = NUMBER
                obj.data = div(self.data, other)
                return obj
            elif lhead is TERMS:
                #DIV_TERMS_VALUE(VALUE=other; LHS=self)
                #MUL_TERMS_VALUE(LHS=self; VALUE=div(1,other))
                #MUL_VALUE_TERMS(VALUE=div(1,other); RHS=self)
                _tmp352 = div(1,other)
                #MUL_ZERO_OP(VALUE=_tmp352; OP=self)
                try:
                    if not _tmp352:
                        if self.has_active():
                            #RETURN_NEW(HEAD=TERMS; DATA={self: 0})
                            #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={self: 0})
                            obj = new(cls)
                            obj.head = TERMS
                            obj.data = {self: 0}
                            return obj
                        else:
                            return cls.zero
                except RedirectOperation:
                    #RETURN_NEW(HEAD=TERMS; DATA={self: _tmp352})
                    #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={self: _tmp352})
                    obj = new(cls)
                    obj.head = TERMS
                    obj.data = {self: _tmp352}
                    return obj
                pairs = self.data
                if len(pairs)==1:
                    t, c = pairs.items()[0]
                    c = _tmp352 * c
                    if c==1:
                        return t
                    #RETURN_NEW(HEAD=TERMS; DATA={t: c})
                    #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={t: c})
                    obj = new(cls)
                    obj.head = TERMS
                    obj.data = {t: c}
                    return obj
                if _tmp352==1:
                    return self
                pairs = {}
                for t,c in self.data.iteritems():
                    c = _tmp352 * c
                    try:
                        if c or t.has_active():
                            pairs[t] = c
                    except RedirectOperation:
                        pairs[t] = c
                #CANONIZE_TERMS_DICT(DICT=pairs)
                if not pairs:
                    return cls.zero
                if len(pairs)==1:
                   t, c = pairs.items()[0]
                   if c==1:
                       return t
                   if t==cls.one:
                       return cls.convert(c)
                #RETURN_NEW(HEAD=TERMS; DATA=pairs)
                #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA=pairs)
                obj = new(cls)
                obj.head = TERMS
                obj.data = pairs
                return obj
            elif lhead is FACTORS:
                #DIV_FACTORS_VALUE(VALUE=other; LHS=self)
                #MUL_FACTORS_VALUE(LHS=self; VALUE=div(1,other))
                #MUL_SYMBOL_VALUE(VALUE=div(1,other); LHS=self)
                #MUL_VALUE_SYMBOL(VALUE=div(1,other); RHS=self)
                _tmp366 = div(1,other)
                #MUL_ZERO_OP(VALUE=_tmp366; OP=self)
                try:
                    if not _tmp366:
                        if self.has_active():
                            #RETURN_NEW(HEAD=TERMS; DATA={self: 0})
                            #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={self: 0})
                            obj = new(cls)
                            obj.head = TERMS
                            obj.data = {self: 0}
                            return obj
                        else:
                            return cls.zero
                except RedirectOperation:
                    #RETURN_NEW(HEAD=TERMS; DATA={self: _tmp366})
                    #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={self: _tmp366})
                    obj = new(cls)
                    obj.head = TERMS
                    obj.data = {self: _tmp366}
                    return obj
                if _tmp366==1:
                    return self
                #RETURN_NEW(HEAD=TERMS; DATA={self: _tmp366})
                #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={self: _tmp366})
                obj = new(cls)
                obj.head = TERMS
                obj.data = {self: _tmp366}
                return obj
            else:
                #DIV_SYMBOL_VALUE(VALUE=other; LHS=self)
                #MUL_VALUE_SYMBOL(VALUE=div(1, other); RHS=self)
                _tmp375 = div(1, other)
                #MUL_ZERO_OP(VALUE=_tmp375; OP=self)
                try:
                    if not _tmp375:
                        if self.has_active():
                            #RETURN_NEW(HEAD=TERMS; DATA={self: 0})
                            #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={self: 0})
                            obj = new(cls)
                            obj.head = TERMS
                            obj.data = {self: 0}
                            return obj
                        else:
                            return cls.zero
                except RedirectOperation:
                    #RETURN_NEW(HEAD=TERMS; DATA={self: _tmp375})
                    #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={self: _tmp375})
                    obj = new(cls)
                    obj.head = TERMS
                    obj.data = {self: _tmp375}
                    return obj
                if _tmp375==1:
                    return self
                #RETURN_NEW(HEAD=TERMS; DATA={self: _tmp375})
                #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={self: _tmp375})
                obj = new(cls)
                obj.head = TERMS
                obj.data = {self: _tmp375}
                return obj
        other = cls.convert(other, False)
        if other is NotImplemented:
            return other
    rhead = other.head
    if lhead is NUMBER:
        if rhead is NUMBER:
            #DIV_NUMBER_NUMBER(LHS=self; RHS=other)
            #DIV_VALUE_NUMBER(VALUE=self.data; RHS=other)
            #RETURN_NEW(HEAD=NUMBER; DATA=div(self.data, other.data))
            #NEWINSTANCE(OBJ=obj; HEAD=NUMBER; DATA=div(self.data, other.data))
            obj = new(cls)
            obj.head = NUMBER
            obj.data = div(self.data, other.data)
            return obj
        elif rhead is TERMS:
            #DIV_NUMBER_TERMS(LHS=self; RHS=other)
            #DIV_VALUE_TERMS(VALUE=self.data; RHS=other)
            #MUL_ZERO_OP(VALUE=self.data; OP=other)
            try:
                if not self.data:
                    if other.has_active():
                        #RETURN_NEW(HEAD=TERMS; DATA={other: 0})
                        #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={other: 0})
                        obj = new(cls)
                        obj.head = TERMS
                        obj.data = {other: 0}
                        return obj
                    else:
                        return cls.zero
            except RedirectOperation:
                #RETURN_NEW(HEAD=TERMS; DATA={other: self.data})
                #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={other: self.data})
                obj = new(cls)
                obj.head = TERMS
                obj.data = {other: self.data}
                return obj
            pairs = other.data
            if len(pairs)==1:
                t, c = pairs.items()[0]
                c = div(self.data, c)
                t = 1/t
                if c==1:
                    return t
                if t==cls.one:
                    return cls.convert(c)
                #RETURN_NEW(HEAD=TERMS; DATA={t: c})
                #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={t: c})
                obj = new(cls)
                obj.head = TERMS
                obj.data = {t: c}
                return obj
            #NEWINSTANCE(OBJ=_tmp388; HEAD=FACTORS; DATA={other: -1})
            _tmp388 = new(cls)
            _tmp388.head = FACTORS
            _tmp388.data = {other: -1}
            if self.data==1:
                return _tmp388
            #RETURN_NEW(HEAD=TERMS; DATA={_tmp388: self.data})
            #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={_tmp388: self.data})
            obj = new(cls)
            obj.head = TERMS
            obj.data = {_tmp388: self.data}
            return obj
        elif rhead is FACTORS:
            #DIV_NUMBER_FACTORS(LHS=self; RHS=other)
            #DIV_VALUE_FACTORS(VALUE=self.data; RHS=other)
            
            pairs = other.data
            if len(pairs)==1:
                t, c = pairs.items()[0]
                c = -c
                if c==1:
                    return t * self.data
                new_pairs = {t: c}
            else:
                #NEG_DICT_VALUES(DICT_IN=pairs; DICT_OUT=new_pairs)
                new_pairs = dict([(t, -c) for t,c in pairs.iteritems()])
            #NEWINSTANCE(OBJ=_tmp400; HEAD=FACTORS; DATA=new_pairs)
            _tmp400 = new(cls)
            _tmp400.head = FACTORS
            _tmp400.data = new_pairs
            if self.data==1:
                return _tmp400
            #RETURN_NEW(HEAD=TERMS; DATA={_tmp400: self.data})
            #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={_tmp400: self.data})
            obj = new(cls)
            obj.head = TERMS
            obj.data = {_tmp400: self.data}
            return obj
        else:
            #DIV_NUMBER_SYMBOL(LHS=self; RHS=other)
            #DIV_VALUE_SYMBOL(VALUE=self.data; RHS=other)
            _tmp406 = self.data
            try:
                if not _tmp406:
                    return cls.zero
            except RedirectOperation:
                pass
            #NEWINSTANCE(OBJ=obj2; HEAD=FACTORS; DATA={other: -1})
            obj2 = new(cls)
            obj2.head = FACTORS
            obj2.data = {other: -1}
            if _tmp406==1:
                return obj2
            #RETURN_NEW(HEAD=TERMS; DATA={obj2: _tmp406})
            #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={obj2: _tmp406})
            obj = new(cls)
            obj.head = TERMS
            obj.data = {obj2: _tmp406}
            return obj
    elif lhead is TERMS:
        if rhead is NUMBER:
            #DIV_TERMS_NUMBER(LHS=self; RHS=other)
            #DIV_TERMS_VALUE(VALUE=other.data; LHS=self)
            #MUL_TERMS_VALUE(LHS=self; VALUE=div(1,other.data))
            #MUL_VALUE_TERMS(VALUE=div(1,other.data); RHS=self)
            _tmp413 = div(1,other.data)
            #MUL_ZERO_OP(VALUE=_tmp413; OP=self)
            try:
                if not _tmp413:
                    if self.has_active():
                        #RETURN_NEW(HEAD=TERMS; DATA={self: 0})
                        #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={self: 0})
                        obj = new(cls)
                        obj.head = TERMS
                        obj.data = {self: 0}
                        return obj
                    else:
                        return cls.zero
            except RedirectOperation:
                #RETURN_NEW(HEAD=TERMS; DATA={self: _tmp413})
                #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={self: _tmp413})
                obj = new(cls)
                obj.head = TERMS
                obj.data = {self: _tmp413}
                return obj
            pairs = self.data
            if len(pairs)==1:
                t, c = pairs.items()[0]
                c = _tmp413 * c
                if c==1:
                    return t
                #RETURN_NEW(HEAD=TERMS; DATA={t: c})
                #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={t: c})
                obj = new(cls)
                obj.head = TERMS
                obj.data = {t: c}
                return obj
            if _tmp413==1:
                return self
            pairs = {}
            for t,c in self.data.iteritems():
                c = _tmp413 * c
                try:
                    if c or t.has_active():
                        pairs[t] = c
                except RedirectOperation:
                    pairs[t] = c
            #CANONIZE_TERMS_DICT(DICT=pairs)
            if not pairs:
                return cls.zero
            if len(pairs)==1:
               t, c = pairs.items()[0]
               if c==1:
                   return t
               if t==cls.one:
                   return cls.convert(c)
            #RETURN_NEW(HEAD=TERMS; DATA=pairs)
            #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA=pairs)
            obj = new(cls)
            obj.head = TERMS
            obj.data = pairs
            return obj
        elif rhead is TERMS:
            #DIV_TERMS_TERMS(LHS=self; RHS=other)
            
            if self==other:
                return cls.one
            lpairs = self.data
            rpairs = other.data
            if len(lpairs)==1:
                t1, c1 = lpairs.items()[0]
                if len(rpairs)==1:
                    t2, c2 = rpairs.items()[0]
                    c = div(c1, c2)
                    if t2==t1:
                        return cls.convert(c)
                    if c==1:
                        #RETURN_NEW(HEAD=FACTORS; DATA={t1:1, t2:-1})
                        #NEWINSTANCE(OBJ=obj; HEAD=FACTORS; DATA={t1:1, t2:-1})
                        obj = new(cls)
                        obj.head = FACTORS
                        obj.data = {t1:1, t2:-1}
                        return obj
                    #NEWINSTANCE(OBJ=_tmp424; HEAD=FACTORS; DATA={t1:1, t2:-1})
                    _tmp424 = new(cls)
                    _tmp424.head = FACTORS
                    _tmp424.data = {t1:1, t2:-1}
                else:
                    #NEWINSTANCE(OBJ=_tmp424; HEAD=FACTORS; DATA={t1:1, other:-1})
                    _tmp424 = new(cls)
                    _tmp424.head = FACTORS
                    _tmp424.data = {t1:1, other:-1}
                #RETURN_NEW(HEAD=TERMS; DATA={_tmp424:c})
                #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={_tmp424:c})
                obj = new(cls)
                obj.head = TERMS
                obj.data = {_tmp424:c}
                return obj
            elif len(rpairs)==1:
                t2, c2 = rpairs.items()[0]
                c = div(1, c2)
                if t2==self:
                    return cls.convert(c)
                _tmp424 = self / t2
                #RETURN_NEW(HEAD=TERMS; DATA={_tmp424:c})
                #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={_tmp424:c})
                obj = new(cls)
                obj.head = TERMS
                obj.data = {_tmp424:c}
                return obj
            #RETURN_NEW(HEAD=FACTORS; DATA={self:1, other:-1})
            #NEWINSTANCE(OBJ=obj; HEAD=FACTORS; DATA={self:1, other:-1})
            obj = new(cls)
            obj.head = FACTORS
            obj.data = {self:1, other:-1}
            return obj
        elif rhead is FACTORS:
            #DIV_TERMS_FACTORS(LHS=self; RHS=other)
            lpairs = self.data
            if len(lpairs)==1:
                t, c = lpairs.items()[0]
                t = t / other
                if t==cls.one:
                    return cls.convert(c)
                head = t.head
                if head is NUMBER:
                    #RETURN_NEW(HEAD=NUMBER; DATA=t.data * c)
                    #NEWINSTANCE(OBJ=obj; HEAD=NUMBER; DATA=t.data * c)
                    obj = new(cls)
                    obj.head = NUMBER
                    obj.data = t.data * c
                    return obj
                elif head is TERMS:
                    #MUL_TERMS_VALUE(LHS=t; VALUE=c)
                    #MUL_VALUE_TERMS(VALUE=c; RHS=t)
                    _tmp439 = c
                    #MUL_ZERO_OP(VALUE=_tmp439; OP=t)
                    try:
                        if not _tmp439:
                            if t.has_active():
                                #RETURN_NEW(HEAD=TERMS; DATA={t: 0})
                                #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={t: 0})
                                obj = new(cls)
                                obj.head = TERMS
                                obj.data = {t: 0}
                                return obj
                            else:
                                return cls.zero
                    except RedirectOperation:
                        #RETURN_NEW(HEAD=TERMS; DATA={t: _tmp439})
                        #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={t: _tmp439})
                        obj = new(cls)
                        obj.head = TERMS
                        obj.data = {t: _tmp439}
                        return obj
                    pairs = t.data
                    if len(pairs)==1:
                        t, c = pairs.items()[0]
                        c = _tmp439 * c
                        if c==1:
                            return t
                        #RETURN_NEW(HEAD=TERMS; DATA={t: c})
                        #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={t: c})
                        obj = new(cls)
                        obj.head = TERMS
                        obj.data = {t: c}
                        return obj
                    if _tmp439==1:
                        return t
                    pairs = {}
                    for t,c in t.data.iteritems():
                        c = _tmp439 * c
                        try:
                            if c or t.has_active():
                                pairs[t] = c
                        except RedirectOperation:
                            pairs[t] = c
                    #CANONIZE_TERMS_DICT(DICT=pairs)
                    if not pairs:
                        return cls.zero
                    if len(pairs)==1:
                       t, c = pairs.items()[0]
                       if c==1:
                           return t
                       if t==cls.one:
                           return cls.convert(c)
                    #RETURN_NEW(HEAD=TERMS; DATA=pairs)
                    #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA=pairs)
                    obj = new(cls)
                    obj.head = TERMS
                    obj.data = pairs
                    return obj
                else:
                    #MUL_SYMBOL_VALUE(LHS=t; VALUE=c)
                    #MUL_VALUE_SYMBOL(VALUE=c; RHS=t)
                    _tmp451 = c
                    #MUL_ZERO_OP(VALUE=_tmp451; OP=t)
                    try:
                        if not _tmp451:
                            if t.has_active():
                                #RETURN_NEW(HEAD=TERMS; DATA={t: 0})
                                #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={t: 0})
                                obj = new(cls)
                                obj.head = TERMS
                                obj.data = {t: 0}
                                return obj
                            else:
                                return cls.zero
                    except RedirectOperation:
                        #RETURN_NEW(HEAD=TERMS; DATA={t: _tmp451})
                        #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={t: _tmp451})
                        obj = new(cls)
                        obj.head = TERMS
                        obj.data = {t: _tmp451}
                        return obj
                    if _tmp451==1:
                        return t
                    #RETURN_NEW(HEAD=TERMS; DATA={t: _tmp451})
                    #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={t: _tmp451})
                    obj = new(cls)
                    obj.head = TERMS
                    obj.data = {t: _tmp451}
                    return obj
            #DIV_SYMBOL_FACTORS(LHS=self; RHS=other)
            pairs = other.data
            if len(pairs)==1:
                t, c = pairs.items()[0]
                if t==self:
                    c = 1 - c
                    try:
                        if not c:
                            return cls.one
                    except RedirectOperation:
                        pass
                    if c==1:
                        return t
                    else:
                        #RETURN_NEW(HEAD=FACTORS; DATA={t: c})
                        #NEWINSTANCE(OBJ=obj; HEAD=FACTORS; DATA={t: c})
                        obj = new(cls)
                        obj.head = FACTORS
                        obj.data = {t: c}
                        return obj
                #RETURN_NEW(HEAD=FACTORS; DATA={t: -c, self: 1})
                #NEWINSTANCE(OBJ=obj; HEAD=FACTORS; DATA={t: -c, self: 1})
                obj = new(cls)
                obj.head = FACTORS
                obj.data = {t: -c, self: 1}
                return obj
            #NEG_DICT_VALUES(DICT_IN=other.data; DICT_OUT=pairs)
            pairs = dict([(t, -c) for t,c in other.data.iteritems()])
            #MUL_DICT_SYMBOL(DICT=pairs; RHS=self)
            #ADD_TERM_VALUE_DICT(TERM=self; VALUE=1; DICT=pairs; DICT_GET=pairs.get)
            b = pairs.get(self)
            if b is None:
                pairs[self] = 1
            else:
                c = b + 1
                try:
                    if c:
                        pairs[self] = c
                    else:
                        del pairs[self]
                except RedirectOperation:
                    pairs[self] = c
            #CANONIZE_FACTORS_DICT1(DICT=pairs)
            if not pairs:
                return cls.one
            if len(pairs)==1:
               t, c = pairs.items()[0]
               if c==1:
                   return t
               if t==cls.one:
                   return t
            #RETURN_NEW(HEAD=FACTORS; DATA=pairs)
            #NEWINSTANCE(OBJ=obj; HEAD=FACTORS; DATA=pairs)
            obj = new(cls)
            obj.head = FACTORS
            obj.data = pairs
            return obj
        else:
            #DIV_TERMS_SYMBOL(LHS=self; RHS=other)
            
            pairs = self.data
            if len(pairs)==1:
                t, c = pairs.items()[0]
                if t==other:
                    return cls.convert(c)
                #NEWINSTANCE(OBJ=_tmp470; HEAD=FACTORS; DATA={t:1, other: -1})
                _tmp470 = new(cls)
                _tmp470.head = FACTORS
                _tmp470.data = {t:1, other: -1}
                #RETURN_NEW(HEAD=TERMS; DATA={_tmp470: c})
                #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={_tmp470: c})
                obj = new(cls)
                obj.head = TERMS
                obj.data = {_tmp470: c}
                return obj
            #RETURN_NEW(HEAD=FACTORS; DATA={self: 1, other: -1})
            #NEWINSTANCE(OBJ=obj; HEAD=FACTORS; DATA={self: 1, other: -1})
            obj = new(cls)
            obj.head = FACTORS
            obj.data = {self: 1, other: -1}
            return obj
    elif lhead is FACTORS:
        if rhead is NUMBER:
            #DIV_FACTORS_NUMBER(LHS=self; RHS=other)
            #DIV_FACTORS_VALUE(VALUE=other.data; LHS=self)
            #MUL_FACTORS_VALUE(LHS=self; VALUE=div(1,other.data))
            #MUL_SYMBOL_VALUE(VALUE=div(1,other.data); LHS=self)
            #MUL_VALUE_SYMBOL(VALUE=div(1,other.data); RHS=self)
            _tmp480 = div(1,other.data)
            #MUL_ZERO_OP(VALUE=_tmp480; OP=self)
            try:
                if not _tmp480:
                    if self.has_active():
                        #RETURN_NEW(HEAD=TERMS; DATA={self: 0})
                        #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={self: 0})
                        obj = new(cls)
                        obj.head = TERMS
                        obj.data = {self: 0}
                        return obj
                    else:
                        return cls.zero
            except RedirectOperation:
                #RETURN_NEW(HEAD=TERMS; DATA={self: _tmp480})
                #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={self: _tmp480})
                obj = new(cls)
                obj.head = TERMS
                obj.data = {self: _tmp480}
                return obj
            if _tmp480==1:
                return self
            #RETURN_NEW(HEAD=TERMS; DATA={self: _tmp480})
            #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={self: _tmp480})
            obj = new(cls)
            obj.head = TERMS
            obj.data = {self: _tmp480}
            return obj
        elif rhead is TERMS:
            #DIV_FACTORS_TERMS(LHS=self; RHS=other)
            rpairs = other.data
            if len(rpairs)==1:
                t, c = rpairs.items()[0]
                t = self / t
                c = div(1, c)
                if t==cls.one:
                    return cls.convert(c)
                head = t.head
                if head is NUMBER:
                    #RETURN_NEW(HEAD=NUMBER; DATA=t.data * c)
                    #NEWINSTANCE(OBJ=obj; HEAD=NUMBER; DATA=t.data * c)
                    obj = new(cls)
                    obj.head = NUMBER
                    obj.data = t.data * c
                    return obj
                elif head is TERMS:
                    #MUL_TERMS_VALUE(LHS=t; VALUE=c)
                    #MUL_VALUE_TERMS(VALUE=c; RHS=t)
                    _tmp492 = c
                    #MUL_ZERO_OP(VALUE=_tmp492; OP=t)
                    try:
                        if not _tmp492:
                            if t.has_active():
                                #RETURN_NEW(HEAD=TERMS; DATA={t: 0})
                                #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={t: 0})
                                obj = new(cls)
                                obj.head = TERMS
                                obj.data = {t: 0}
                                return obj
                            else:
                                return cls.zero
                    except RedirectOperation:
                        #RETURN_NEW(HEAD=TERMS; DATA={t: _tmp492})
                        #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={t: _tmp492})
                        obj = new(cls)
                        obj.head = TERMS
                        obj.data = {t: _tmp492}
                        return obj
                    pairs = t.data
                    if len(pairs)==1:
                        t, c = pairs.items()[0]
                        c = _tmp492 * c
                        if c==1:
                            return t
                        #RETURN_NEW(HEAD=TERMS; DATA={t: c})
                        #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={t: c})
                        obj = new(cls)
                        obj.head = TERMS
                        obj.data = {t: c}
                        return obj
                    if _tmp492==1:
                        return t
                    pairs = {}
                    for t,c in t.data.iteritems():
                        c = _tmp492 * c
                        try:
                            if c or t.has_active():
                                pairs[t] = c
                        except RedirectOperation:
                            pairs[t] = c
                    #CANONIZE_TERMS_DICT(DICT=pairs)
                    if not pairs:
                        return cls.zero
                    if len(pairs)==1:
                       t, c = pairs.items()[0]
                       if c==1:
                           return t
                       if t==cls.one:
                           return cls.convert(c)
                    #RETURN_NEW(HEAD=TERMS; DATA=pairs)
                    #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA=pairs)
                    obj = new(cls)
                    obj.head = TERMS
                    obj.data = pairs
                    return obj
                else:
                    #MUL_SYMBOL_VALUE(LHS=t; VALUE=c)
                    #MUL_VALUE_SYMBOL(VALUE=c; RHS=t)
                    _tmp504 = c
                    #MUL_ZERO_OP(VALUE=_tmp504; OP=t)
                    try:
                        if not _tmp504:
                            if t.has_active():
                                #RETURN_NEW(HEAD=TERMS; DATA={t: 0})
                                #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={t: 0})
                                obj = new(cls)
                                obj.head = TERMS
                                obj.data = {t: 0}
                                return obj
                            else:
                                return cls.zero
                    except RedirectOperation:
                        #RETURN_NEW(HEAD=TERMS; DATA={t: _tmp504})
                        #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={t: _tmp504})
                        obj = new(cls)
                        obj.head = TERMS
                        obj.data = {t: _tmp504}
                        return obj
                    if _tmp504==1:
                        return t
                    #RETURN_NEW(HEAD=TERMS; DATA={t: _tmp504})
                    #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={t: _tmp504})
                    obj = new(cls)
                    obj.head = TERMS
                    obj.data = {t: _tmp504}
                    return obj
            #DIV_FACTORS_SYMBOL(LHS=self; RHS=other)
            pairs = dict(self.data)
            #DIV_DICT_SYMBOL(RHS=other; DICT=pairs)
            #ADD_TERM_VALUE_DICT(TERM=other; VALUE=-1; DICT=pairs; DICT_GET=pairs.get)
            b = pairs.get(other)
            if b is None:
                pairs[other] = -1
            else:
                c = b + -1
                try:
                    if c:
                        pairs[other] = c
                    else:
                        del pairs[other]
                except RedirectOperation:
                    pairs[other] = c
            #CANONIZE_FACTORS_DICT1(DICT=pairs)
            if not pairs:
                return cls.one
            if len(pairs)==1:
               t, c = pairs.items()[0]
               if c==1:
                   return t
               if t==cls.one:
                   return t
            #RETURN_NEW(HEAD=FACTORS; DATA=pairs)
            #NEWINSTANCE(OBJ=obj; HEAD=FACTORS; DATA=pairs)
            obj = new(cls)
            obj.head = FACTORS
            obj.data = pairs
            return obj
        elif rhead is FACTORS:
            #DIV_FACTORS_FACTORS(LHS=self; RHS=other)
            pairs = dict(self.data)
            pairs_get = pairs.get
            number = 1
            for t,c in other.data.iteritems():
                #MUL_FACTOR_VALUE_DICT(FACTOR=t; VALUE=-c; DICT=pairs; DICT_GET=pairs_get; NUMBER=number)
                b = pairs_get(t)
                if b is None:
                    pairs[t] = -c
                else:
                    _tmp519 = b + -c
                    try:
                        if _tmp519:
                            if t.head is NUMBER:
                                r = t ** _tmp519
                                if r.head is NUMBER:
                                    number *= r
                                    del pairs[t]
                                else:
                                    pairs[t] = _tmp519
                            else:
                                pairs[t] = _tmp519
                        else:
                            del pairs[t]
                    except RedirectOperation:
                        pairs[t] = _tmp519
            #CANONIZE_FACTORS_DICT(DICT=pairs; NUMBER=number)
            if not pairs:
                if number is 1:
                    return cls.one
                return number
            if len(pairs)==1:
               t, c = pairs.items()[0]
               if c==1:
                   return t * number
               if t==cls.one:
                   return number
            if number==1:
                #RETURN_NEW(HEAD=FACTORS; DATA=pairs)
                #NEWINSTANCE(OBJ=obj; HEAD=FACTORS; DATA=pairs)
                obj = new(cls)
                obj.head = FACTORS
                obj.data = pairs
                return obj
            #NEWINSTANCE(OBJ=_tmp518; HEAD=FACTORS; DATA=pairs)
            _tmp518 = new(cls)
            _tmp518.head = FACTORS
            _tmp518.data = pairs
            #RETURN_NEW(HEAD=TERMS; DATA={_tmp518: number})
            #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={_tmp518: number})
            obj = new(cls)
            obj.head = TERMS
            obj.data = {_tmp518: number}
            return obj
        else:
            #DIV_FACTORS_SYMBOL(LHS=self; RHS=other)
            pairs = dict(self.data)
            #DIV_DICT_SYMBOL(RHS=other; DICT=pairs)
            #ADD_TERM_VALUE_DICT(TERM=other; VALUE=-1; DICT=pairs; DICT_GET=pairs.get)
            b = pairs.get(other)
            if b is None:
                pairs[other] = -1
            else:
                c = b + -1
                try:
                    if c:
                        pairs[other] = c
                    else:
                        del pairs[other]
                except RedirectOperation:
                    pairs[other] = c
            #CANONIZE_FACTORS_DICT1(DICT=pairs)
            if not pairs:
                return cls.one
            if len(pairs)==1:
               t, c = pairs.items()[0]
               if c==1:
                   return t
               if t==cls.one:
                   return t
            #RETURN_NEW(HEAD=FACTORS; DATA=pairs)
            #NEWINSTANCE(OBJ=obj; HEAD=FACTORS; DATA=pairs)
            obj = new(cls)
            obj.head = FACTORS
            obj.data = pairs
            return obj
    else:
        if rhead is NUMBER:
            #DIV_SYMBOL_NUMBER(LHS=self; RHS=other)
            #DIV_SYMBOL_VALUE(VALUE=other.data; LHS=self)
            #MUL_VALUE_SYMBOL(VALUE=div(1, other.data); RHS=self)
            _tmp534 = div(1, other.data)
            #MUL_ZERO_OP(VALUE=_tmp534; OP=self)
            try:
                if not _tmp534:
                    if self.has_active():
                        #RETURN_NEW(HEAD=TERMS; DATA={self: 0})
                        #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={self: 0})
                        obj = new(cls)
                        obj.head = TERMS
                        obj.data = {self: 0}
                        return obj
                    else:
                        return cls.zero
            except RedirectOperation:
                #RETURN_NEW(HEAD=TERMS; DATA={self: _tmp534})
                #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={self: _tmp534})
                obj = new(cls)
                obj.head = TERMS
                obj.data = {self: _tmp534}
                return obj
            if _tmp534==1:
                return self
            #RETURN_NEW(HEAD=TERMS; DATA={self: _tmp534})
            #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={self: _tmp534})
            obj = new(cls)
            obj.head = TERMS
            obj.data = {self: _tmp534}
            return obj
        elif rhead is TERMS:
            #DIV_SYMBOL_TERMS(LHS=self; RHS=other)
            pairs = other.data
            if len(pairs)==1:
                t,c = pairs.items()[0]
                if self==t:
                    return cls.convert(div(1, c))
                #NEWINSTANCE(OBJ=_tmp542; HEAD=FACTORS; DATA={self:1, t:-1})
                _tmp542 = new(cls)
                _tmp542.head = FACTORS
                _tmp542.data = {self:1, t:-1}
                #RETURN_NEW(HEAD=TERMS; DATA={_tmp542: div(1, c)})
                #NEWINSTANCE(OBJ=obj; HEAD=TERMS; DATA={_tmp542: div(1, c)})
                obj = new(cls)
                obj.head = TERMS
                obj.data = {_tmp542: div(1, c)}
                return obj
            #RETURN_NEW(HEAD=FACTORS; DATA={self:1, other:-1})
            #NEWINSTANCE(OBJ=obj; HEAD=FACTORS; DATA={self:1, other:-1})
            obj = new(cls)
            obj.head = FACTORS
            obj.data = {self:1, other:-1}
            return obj
        elif rhead is FACTORS:
            #DIV_SYMBOL_FACTORS(LHS=self; RHS=other)
            pairs = other.data
            if len(pairs)==1:
                t, c = pairs.items()[0]
                if t==self:
                    c = 1 - c
                    try:
                        if not c:
                            return cls.one
                    except RedirectOperation:
                        pass
                    if c==1:
                        return t
                    else:
                        #RETURN_NEW(HEAD=FACTORS; DATA={t: c})
                        #NEWINSTANCE(OBJ=obj; HEAD=FACTORS; DATA={t: c})
                        obj = new(cls)
                        obj.head = FACTORS
                        obj.data = {t: c}
                        return obj
                #RETURN_NEW(HEAD=FACTORS; DATA={t: -c, self: 1})
                #NEWINSTANCE(OBJ=obj; HEAD=FACTORS; DATA={t: -c, self: 1})
                obj = new(cls)
                obj.head = FACTORS
                obj.data = {t: -c, self: 1}
                return obj
            #NEG_DICT_VALUES(DICT_IN=other.data; DICT_OUT=pairs)
            pairs = dict([(t, -c) for t,c in other.data.iteritems()])
            #MUL_DICT_SYMBOL(DICT=pairs; RHS=self)
            #ADD_TERM_VALUE_DICT(TERM=self; VALUE=1; DICT=pairs; DICT_GET=pairs.get)
            b = pairs.get(self)
            if b is None:
                pairs[self] = 1
            else:
                c = b + 1
                try:
                    if c:
                        pairs[self] = c
                    else:
                        del pairs[self]
                except RedirectOperation:
                    pairs[self] = c
            #CANONIZE_FACTORS_DICT1(DICT=pairs)
            if not pairs:
                return cls.one
            if len(pairs)==1:
               t, c = pairs.items()[0]
               if c==1:
                   return t
               if t==cls.one:
                   return t
            #RETURN_NEW(HEAD=FACTORS; DATA=pairs)
            #NEWINSTANCE(OBJ=obj; HEAD=FACTORS; DATA=pairs)
            obj = new(cls)
            obj.head = FACTORS
            obj.data = pairs
            return obj
        else:
            #DIV_SYMBOL_SYMBOL(LHS=self; RHS=other)
            if self == other:
                return cls.one
            #RETURN_NEW(HEAD=FACTORS; DATA={self: 1, other: -1})
            #NEWINSTANCE(OBJ=obj; HEAD=FACTORS; DATA={self: 1, other: -1})
            obj = new(cls)
            obj.head = FACTORS
            obj.data = {self: 1, other: -1}
            return obj
