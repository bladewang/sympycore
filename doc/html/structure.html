<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.4.1: http://docutils.sourceforge.net/" />
<title>Structure of SympyCore</title>
<meta name="author" content="Pearu Peterson" />
<style type="text/css">

/*
:Author: Pearu Peterson
:Contact: pearu.peterson AT gmail DOT com
:Copyright: This stylesheet has been placed in the public domain.

Stylesheet for use with Docutils.
*/

@import url(html4css1.css);

/* Your customizations go here.  For example: */

body {
    margin:0px;
    padding:25px;
    background-color: #ccc;
    font-size: 13px; font-family: arial, sans-serif;
    line-height:1.5em;
}

div.document {
    max-width: 700px;
    color: #000;
    background-color: #fff;
    padding:25px;
    border:5px solid #ddd;
}

div.sidebar {
  margin-left: 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

pre, tt {
  font-family: consolas, lucida console, courier new, monospace;
  color: #000080 ;
}

pre.literal-block, pre.doctest-block {
  line-height:1.3em;
  border-top:1px solid #ccc;
  border-bottom:1px solid #ccc;
  background-color:#f0f0f0;
  color: #000080 ;
}

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 0.5em;
  background-color: #fffacd;  
}

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

</style>
</head>
<body>
<div class="document" id="structure-of-sympycore">
<h1 class="title">Structure of SympyCore</h1>
<table class="docinfo" frame="void" rules="none">
<col class="docinfo-name" />
<col class="docinfo-content" />
<tbody valign="top">
<tr><th class="docinfo-name">Author:</th>
<td>Pearu Peterson</td></tr>
<tr class="field"><th class="docinfo-name">Website:</th><td class="field-body"><a class="reference" href="http://sympycore.googlecode.com">http://sympycore.googlecode.com</a></td>
</tr>
<tr class="field"><th class="docinfo-name">Created:</th><td class="field-body">March 2008</td>
</tr>
</tbody>
</table>
<!-- -*- rest -*- -->
<div class="sidebar">
<p class="first sidebar-title">Table of contents</p>
<div class="contents local last topic">
<ul class="auto-toc simple">
<li><a class="reference" href="#introduction" id="id1" name="id1">1&nbsp;&nbsp;&nbsp;Introduction</a></li>
<li><a class="reference" href="#fundamental-idea" id="id2" name="id2">2&nbsp;&nbsp;&nbsp;Fundamental idea</a><ul class="auto-toc">
<li><a class="reference" href="#implementation-of-principles" id="id3" name="id3">2.1&nbsp;&nbsp;&nbsp;Implementation of principles</a></li>
<li><a class="reference" href="#constructing-instances" id="id4" name="id4">2.2&nbsp;&nbsp;&nbsp;Constructing instances</a></li>
<li><a class="reference" href="#various-representations" id="id5" name="id5">2.3&nbsp;&nbsp;&nbsp;Various representations</a></li>
</ul>
</li>
<li><a class="reference" href="#classes-in-sympycore" id="id6" name="id6">3&nbsp;&nbsp;&nbsp;Classes in Sympycore</a><ul class="auto-toc">
<li><a class="reference" href="#low-level-numbers" id="id7" name="id7">3.1&nbsp;&nbsp;&nbsp;Low-level numbers</a></li>
<li><a class="reference" href="#verbatim-algebra" id="id8" name="id8">3.2&nbsp;&nbsp;&nbsp;Verbatim algebra</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section">
<h1><a class="toc-backref" href="#id1" id="introduction" name="introduction">1&nbsp;&nbsp;&nbsp;Introduction</a></h1>
<p>This document gives an overview of data types that are used in
<tt class="docutils literal"><span class="pre">sympycore</span></tt> to represent symbolic expressions. First, the fundametal
idea of defining a Python type <tt class="docutils literal"><span class="pre">Expr</span></tt>, that holds a pair of Python
objects, is explained. Then <tt class="docutils literal"><span class="pre">Expr</span></tt> is used to implement classes that
represent different mathematical concepts --- the actual class
structure of <tt class="docutils literal"><span class="pre">sympycore</span></tt> is outlined. Subsequent sections document
the features of <tt class="docutils literal"><span class="pre">sympycore</span></tt> classes in detail.</p>
</div>
<div class="section">
<h1><a class="toc-backref" href="#id2" id="fundamental-idea" name="fundamental-idea">2&nbsp;&nbsp;&nbsp;Fundamental idea</a></h1>
<p>The fundamental idea behind the implementation of <tt class="docutils literal"><span class="pre">sympycore</span></tt>
classes is based on the following assertions:</p>
<ul class="simple">
<li>Any symbolic expression can be expressed as a pair of <em>expression
head</em> and <em>expression data</em>. The <em>expression head</em> contains
information how the <em>expression data</em> is interpreted. The head and
data pair will be saved as attributes of <tt class="docutils literal"><span class="pre">Expr</span></tt> class.</li>
<li>The mathematical meaning of symbolic expressions depends on the
assumption to what <em>algebraic structure</em> the possible values of a
symbolic expression belong. The specified algebraic structure
defines the rules for how the symbolic expressions can be combined
in algebraic operations. These rules are implemented in classes
derived from the <tt class="docutils literal"><span class="pre">Expr</span></tt> class.</li>
</ul>
<p>In the following we call a algebraic structure as an algebra for
brevity.</p>
<div class="section">
<h2><a class="toc-backref" href="#id3" id="implementation-of-principles" name="implementation-of-principles">2.1&nbsp;&nbsp;&nbsp;Implementation of principles</a></h2>
<div class="warning">
<p class="first admonition-title">Warning</p>
<p class="last">The Python code fragments shown in this section are presented only
for illustration purposes. The <tt class="docutils literal"><span class="pre">sympycore</span></tt> may use slightly
different implementation (explained in the following sections) that
gives a better performance. However, the basic ideas remain the
same.</p>
</div>
<p>In <tt class="docutils literal"><span class="pre">sympycore</span></tt>, any symbolic expression is defined as an instance of a
<tt class="docutils literal"><span class="pre">Expr</span></tt> class (or one of its subclasses):</p>
<pre class="literal-block">
class Expr(object):

    def __init__(self, head, data):
        self.pair = (head, data)
        self.head = head
        self.data = data
</pre>
<p>In a way, the <tt class="docutils literal"><span class="pre">Expr</span></tt> class represents an algebra with no
mathematical properties - it just holds some <em>head</em> and some <em>data</em>.</p>
<p>To define an algebra with additional properties that define opertions
between its elements, a Python class is derived from the <tt class="docutils literal"><span class="pre">Expr</span></tt>
class:</p>
<pre class="literal-block">
class Algebra(Expr):

     def operation(self, other):
         ...
         return result
</pre>
<p>where an operation between algerba elements is implemented in a method
<tt class="docutils literal"><span class="pre">operation</span></tt>.</p>
<p>For example. a commutative ring element can be represented as an
instance of the following class:</p>
<pre class="literal-block">
class CommutativeRing(Expr):

     def __add__(self, other):
         return CommutativeRing('+', (self, other))

     __radd__ = __add__ # addition is commutative

     def __mul__(self, other):
         return CommutativeRing('*', (self, other))
</pre>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id4" id="constructing-instances" name="constructing-instances">2.2&nbsp;&nbsp;&nbsp;Constructing instances</a></h2>
<p>For convenience, one can provide additional methods or functions that
will simplify creating instances of the <tt class="docutils literal"><span class="pre">Expr</span></tt> based classes. For
example, to construct a symbol of a commutative ring, one can define
the following function:</p>
<pre class="literal-block">
def Symbol(name):
    return CommutativeRing('S', name)
</pre>
<p>To construct a number of a commutative ring, one can define:</p>
<pre class="literal-block">
def Number(value):
    return CommutativeRing('N', value)
</pre>
<p>To construct an applied unary function with a value in a commutative
ring, one can define:</p>
<pre class="literal-block">
def F(x):
    &quot;Return the value of function F&quot;
    return &lt;result&gt;

def Apply(function, argument):
    return CommutativeRing(function, argument)
</pre>
<p>Since <tt class="docutils literal"><span class="pre">sympycore</span></tt> defines many classes representing different
algebras, the functions above are usually implemented as Python
<tt class="docutils literal"><span class="pre">classmethod</span></tt>'s of the corresponding algebra classes. Also, the used
<tt class="docutils literal"><span class="pre">head</span></tt> parts may be changed to anything more appropiate.</p>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id5" id="various-representations" name="various-representations">2.3&nbsp;&nbsp;&nbsp;Various representations</a></h2>
<p>Note that a fixed symbolic expression may have different but
mathematically equivalent representations. For example, consider the
following symbolic expression:</p>
<pre class="literal-block">
x**3 + 2*y
</pre>
<p>This expression may have at least three different representations:</p>
<pre class="literal-block">
Ring(head='ADD',   data=(x**3, 2*y))
Ring(head='TERMS', data=((x**3, 1), (y, 2)))
Ring(head=(x,y),   data=(((3,0), 1), ((0,1), 2)))
</pre>
<p>where the <tt class="docutils literal"><span class="pre">data</span></tt> structures are interpreted as follows:</p>
<pre class="literal-block">
(x**3) + (2*y)
(x**3) * 1 + y * 2
x**3 * y**0 * 1 + x**0 * y**1 * 2
</pre>
<p>respectively.</p>
<p>In general, there is no preferred representation for a symbolic
expression, each representation has its pros and cons depending on
applications.</p>
</div>
</div>
<div class="section">
<h1><a class="toc-backref" href="#id6" id="classes-in-sympycore" name="classes-in-sympycore">3&nbsp;&nbsp;&nbsp;Classes in Sympycore</a></h1>
<p>The following diagram summarizes the class structure of <tt class="docutils literal"><span class="pre">sympycore</span></tt>:</p>
<pre class="literal-block">
object
  Expr
    Algebra
      Verbatim
      CommutativeRing
        CollectingField
          Calculus
          Unit
      PolynomialRing[&lt;variables&gt;, &lt;coefficient ring&gt;]
      MatrixRing[&lt;shape&gt;, &lt;element ring&gt;]
</pre>
<div class="section">
<h2><a class="toc-backref" href="#id7" id="low-level-numbers" name="low-level-numbers">3.1&nbsp;&nbsp;&nbsp;Low-level numbers</a></h2>
<p>Many algebras define numbers as generalized repetitions of the algebra
unit element. Sympycore uses and defines the following number types
for purely numerical task, i.e. both operands and operation results
are numbers):</p>
<table border="1" class="docutils">
<colgroup>
<col width="17%" />
<col width="83%" />
</colgroup>
<tbody valign="top">
<tr><td>int, long</td>
<td>integers of arbitrary size</td>
</tr>
<tr><td>mpq</td>
<td>fractions</td>
</tr>
<tr><td>mpf</td>
<td>arbitrary precision floating point numbers</td>
</tr>
<tr><td>mpqc</td>
<td>complex numbers with rational parts</td>
</tr>
<tr><td>mpc</td>
<td>arbitrary precision complex floating point numbers</td>
</tr>
</tbody>
</table>
<p>Python <tt class="docutils literal"><span class="pre">float</span></tt> and <tt class="docutils literal"><span class="pre">complex</span></tt> instances are converted to <tt class="docutils literal"><span class="pre">mpf</span></tt>
and <tt class="docutils literal"><span class="pre">mpc</span></tt> instances, respectively.</p>
<p>These number types are called &quot;low-level&quot; numbers because some of
their properties may be unusual for generic numbers but these
properties are introduced to improve the efficiency of number
operations.</p>
<p>For example, <tt class="docutils literal"><span class="pre">mpq</span></tt> number is assumed to hold a normalized rational
number that is not integer.  Operation between <tt class="docutils literal"><span class="pre">mpq</span></tt> instances that
would produce integer result, will return <tt class="docutils literal"><span class="pre">int</span></tt> (or <tt class="docutils literal"><span class="pre">long</span></tt>)
instance. Similarly, the real valued result of an operation between
complex numbers <tt class="docutils literal"><span class="pre">mpqc</span></tt> (or <tt class="docutils literal"><span class="pre">mpc</span></tt>) will be an instance of <tt class="docutils literal"><span class="pre">int</span></tt>
or <tt class="docutils literal"><span class="pre">long</span></tt> or <tt class="docutils literal"><span class="pre">mpq</span></tt> (or <tt class="docutils literal"><span class="pre">mpf</span></tt>) type.</p>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id8" id="verbatim-algebra" name="verbatim-algebra">3.2&nbsp;&nbsp;&nbsp;Verbatim algebra</a></h2>
<p>Sympycore defines <tt class="docutils literal"><span class="pre">Verbatim</span></tt> class that represents verbatim algebra.
Verbatim algebra contains expressions in unevaluated form.</p>
</div>
</div>
</div>
</body>
</html>
